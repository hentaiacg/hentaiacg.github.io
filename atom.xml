<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rishinyan</title>
  <icon>https://www.gravatar.com/avatar/41013d0ee83ef3224fadc69640a60e97</icon>
  <subtitle>Wisdom begins in wonder.</subtitle>
  <link href="https://blog.rishinyan.top/atom.xml" rel="self"/>
  
  <link href="https://blog.rishinyan.top/"/>
  <updated>2025-01-11T07:30:00.000Z</updated>
  <id>https://blog.rishinyan.top/</id>
  
  <author>
    <name>Rishinyan</name>
    <email>shinyanri@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Jeff&#39;s Playlist</title>
    <link href="https://blog.rishinyan.top/Jeff&#39;sPlaylist/"/>
    <id>https://blog.rishinyan.top/Jeff&#39;sPlaylist/</id>
    <published>2025-01-11T07:30:00.000Z</published>
    <updated>2025-01-11T07:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><p>emotional</p>        <div id="aplayer-mTphmkIU" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":false,"showlrc":0,"music":[{"title":"Cry For Me (feat. Ami)","author":"Michita","url":"http://music.163.com/song/media/outer/url?id=27681762.mp3","pic":"http://p2.music.126.net/l23qXUnvTLv2CcFPsJyLEg==/109951170068139096.jpg?param=130y130"},{"title":"There's No Ending","author":"RUANN","url":"http://music.163.com/song/media/outer/url?id=1323304406.mp3","pic":"http://p1.music.126.net/axRnGOYWPKHo0pwYHyqTzQ==/109951163655467590.jpg?param=130y130"}]};  options.element = document.getElementById("aplayer-mTphmkIU");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script><p>Rock</p>        <div id="aplayer-gWVZivBz" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":false,"showlrc":0,"music":[{"title":"REDLINE DAY","author":"James Shimoji","url":"http://music.163.com/song/media/outer/url?id=22716614.mp3","pic":"http://p1.music.126.net/6dnNDpUDFdwUgOTpWqycMQ==/109951169037350454.jpg?param=130y130"}]};  options.element = document.getElementById("aplayer-gWVZivBz");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script>]]></content>
    
    
    <summary type="html">Jeff&#39;s information</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Centos7.9 ç¼–è¯‘ Hadoop3.4.0</title>
    <link href="https://blog.rishinyan.top/CentosCompliesHadoop/"/>
    <id>https://blog.rishinyan.top/CentosCompliesHadoop/</id>
    <published>2024-07-18T10:33:00.000Z</published>
    <updated>2025-03-03T18:14:55.334Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h2 id="ä»‹ç»">ä»‹ç»</h2><p>hadoop å¼€å‘ç¯å¢ƒï¼Œä»¥åŠé˜…è¯»æºç </p><h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2><div class="note info flat"><p>hadoop building æ‰€éœ€ç¯å¢ƒ, å‚è€ƒ <code>hadoop-3.4.0-src\BUILDING.txt</code> æ–‡ä»¶</p></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Requirements:</span><br><span class="line"></span><br><span class="line">* Unix System ç±» unix ç³»ç»Ÿ</span><br><span class="line">* JDK 1.8 java8ç‰ˆæœ¬ï¼Œhadoop ç”± java ç¼–å†™</span><br><span class="line">* Maven 3.3 or later æä¾› hadoop ç¼–è¯‘ä¾èµ–åŒ…</span><br><span class="line">* Boost 1.72 (if compiling native code) æä¾› C++ åº“ï¼Œå¢å¼º C++ çš„åŠŸèƒ½</span><br><span class="line">* Protocol Buffers 3.7.1 (if compiling native code) ç”¨äºåºåˆ—åŒ–ç»“æ„åŒ–æ•°æ®</span><br><span class="line">* CMake 3.19 or newer (if compiling native code) è·¨å¹³å°çš„æ„å»ºç³»ç»Ÿï¼Œç”¨äºç®¡ç†ç¼–è¯‘è¿‡ç¨‹</span><br><span class="line">* Zlib devel (if compiling native code) ç”¨äºæ•°æ®å‹ç¼©çš„åº“ï¼Œå¤„ç†å‹ç¼©æ•°æ®</span><br><span class="line">* Cyrus SASL devel (if compiling native code) ç”¨äºè®¤è¯å’Œæ•°æ®å®‰å…¨</span><br><span class="line">* One of the compilers that support thread_local storage: GCC 9.3.0 or later, Visual Studio,</span><br><span class="line">  Clang (community version), Clang (version for iOS 9 and later) (if compiling native code) æ”¯æŒ thread_local å­˜å‚¨çš„ç¼–è¯‘å™¨ï¼Œå¦‚ GCC 9.3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä½¿ç”¨çº¿ç¨‹å±€éƒ¨å­˜å‚¨æ¥ç®¡ç†å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„æ•°æ®</span><br><span class="line">* openssl devel (if compiling native hadoop-pipes and to get the best HDFS encryption performance) OpenSSL å¼€å‘åº“ï¼Œç”¨äºåŠ å¯†å’Œè§£å¯†</span><br><span class="line">* Linux FUSE (Filesystem in Userspace) version 2.6 or above (if compiling fuse_dfs) FUSE å…è®¸ç”¨æˆ·åœ¨ç”¨æˆ·ç©ºé—´åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚Hadoop çš„ fuse_dfs æ¨¡å—éœ€è¦å®ƒæ¥å®ç° HDFS ä¸ FUSE çš„é›†æˆ</span><br><span class="line">* Doxygen ( if compiling libhdfspp and generating the documents ) æ–‡æ¡£ç”Ÿæˆå™¨ï¼Œç”¨äºä»æºä»£ç ç”Ÿæˆæ–‡æ¡£ï¼Œlibhdfspp æ¨¡å—çš„æ–‡æ¡£ç”Ÿæˆéœ€è¦</span><br><span class="line">* Internet connection for first build (to fetch all Maven and Hadoop dependencies) åˆæ¬¡æ„å»ºéœ€è¦äº’è”ç½‘è¿æ¥ä»¥è·å–æ‰€æœ‰çš„ Maven å’Œ Hadoop ä¾èµ–é¡¹</span><br><span class="line">* python (for releasedocs) Python ç”¨äºè‡ªåŠ¨åŒ–ç”Ÿæˆå‘å¸ƒæ–‡æ¡£çš„è¿‡ç¨‹</span><br><span class="line">* bats (for shell code testing) ç”¨äºæµ‹è¯• Bash è„šæœ¬çš„å·¥å…·ï¼ŒHadoop ä½¿ç”¨å®ƒæ¥æµ‹è¯• shell ä»£ç </span><br><span class="line">* Node.js / bower / Ember-cli (for YARN UI v2 building) æ„å»º YARN çš„ UI v2ï¼›Node.js æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œç¯å¢ƒï¼›Bower æ˜¯ä¸€ä¸ªå‰ç«¯åŒ…ç®¡ç†å·¥å…·ï¼›Ember-cli æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Ember.js åº”ç”¨çš„å·¥å…·</span><br></pre></td></tr></table></figure><div class="note info flat"><p>éƒ¨ç½²çš„ç¯å¢ƒ</p></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br><span class="line">java 8</span><br><span class="line">maven 3.9.8</span><br><span class="line">python2</span><br><span class="line">Protocol 3.7.1</span><br><span class="line">GCC 9.3.0</span><br><span class="line">CMake 3.19</span><br><span class="line">Boost 1.72.0</span><br><span class="line">snappy-devel</span><br><span class="line">libzstd-devel</span><br><span class="line">isa-l</span><br><span class="line">Hadoop 3.4.0 æºç </span><br></pre></td></tr></table></figure><h3 id="é…ç½®åŸºæœ¬ç¯å¢ƒ">é…ç½®åŸºæœ¬ç¯å¢ƒ</h3><div class="note primary flat"><p>æ“ä½œå‡ä½¿ç”¨ root ç”¨æˆ·ï¼Œè‹¥ä¸æ˜¯ root ç”¨æˆ·ï¼Œç¡®ä¿æ‹¥æœ‰ sudo æƒé™</p><p>æ‰€æ¶‰åŠåº”ç”¨ï¼Œå‡é»˜è®¤åœ¨ <code>/opt</code> ç›®å½•ä¸‹</p></div><hr><h4 id="1-Yum-é…ç½®">1. Yum é…ç½®</h4><p>é…ç½® yum æº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤‡ä»½åŸé…ç½®</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨å›½å†… yum æº</span></span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿæˆå®Œæ•´ç¼“å­˜</span></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ yum æºæ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure><p>é…ç½® epel</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… epel æº</span></span><br><span class="line">yum install epel-release -y</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿæˆå®Œæ•´ç¼“å­˜</span></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ yum æºæ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure><p>é…ç½® scl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… scl æº</span></span><br><span class="line">yum install -y centos-release-scl centos-release-scl-rh scl-utils scl-utils-build</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤‡ä»½</span></span><br><span class="line">cp CentOS-SCLo-scl.repo&#123;,.bak&#125;</span><br><span class="line">cp CentOS-SCLo-scl-rh.repo&#123;,.bak&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ scl é…ç½®</span></span><br><span class="line">vi /etc/yum.repos.d/CentOS-SCLo-scl.repo</span><br><span class="line">[centos-sclo-sclo]</span><br><span class="line">name=CentOS-7 - SCLo sclo</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/7/sclo/$basearch/sclo/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"></span><br><span class="line">vi /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo</span><br><span class="line">[centos-sclo-rh]</span><br><span class="line">name=CentOS-7 - SCLo rh</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/7/sclo/$basearch/rh/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ·æ–°ç¼“å­˜</span></span><br><span class="line">yum clean all &amp;&amp; yum makecache </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ yum æºæ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure><h4 id="2-å®‰è£…å¼€å‘å·¥å…·">2. å®‰è£…å¼€å‘å·¥å…·</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y groupinstall &#x27;Development Tools&#x27;</span><br></pre></td></tr></table></figure><h4 id="3-å®‰è£…-Python2">3. å®‰è£… Python2</h4><p>å®‰è£… python2 å»æ„å»ºæ–‡æ¡£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install python2</span><br></pre></td></tr></table></figure><h4 id="4-å®‰è£…-Protocol-Buffers">4. å®‰è£… Protocol Buffers</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">git clone https://github.com/protocolbuffers/protobuf</span><br><span class="line">cd protobuf</span><br><span class="line">git checkout v3.7.1</span><br><span class="line">autoreconf -i</span><br><span class="line">./configure --prefix=/usr/local</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><h4 id="5-å®‰è£…å¿…é¡»åŒ…">5. å®‰è£…å¿…é¡»åŒ…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libtirpc-devel zlib-devel lz4-devel bzip2-devel openssl-devel cyrus-sasl-devel libpmem-devel libffi-devel</span><br></pre></td></tr></table></figure><h4 id="6-å®‰è£…-GCC">6. å®‰è£… GCC</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install devtoolset-9 -y</span><br><span class="line">source /opt/rh/devtoolset-9/enable</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç‰ˆæœ¬</span></span><br><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br></pre></td></tr></table></figure><h4 id="7-å®‰è£…-CMAKE">7. å®‰è£… CMAKE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">curl -L https://cmake.org/files/v3.19/cmake-3.19.0.tar.gz &gt; cmake-3.19.0.tar.gz</span><br><span class="line">tar -zxvf cmake-3.19.0.tar.gz &amp;&amp; cd cmake-3.19.0</span><br><span class="line">./bootstrap</span><br><span class="line">make -j$(nproc)</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><h4 id="8-å®‰è£…-Boost">8. å®‰è£… Boost</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">curl -L -o boost_1_72_0.tar.bz2 https://sourceforge.net/projects/boost/files/boost/1.72.0/boost_1_72_0.tar.bz2/download</span><br><span class="line">tar xjf boost_1_72_0.tar.bz2</span><br><span class="line">cd boost_1_72_0</span><br><span class="line">./bootstrap.sh --prefix=/usr/local</span><br><span class="line">./b2</span><br><span class="line">./b2 install</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><h4 id="9-å…¶ä»–">9. å…¶ä»–</h4><ul><li><strong>snappy-devel</strong>: Snappy å‹ç¼©åº“çš„å¼€å‘æ–‡ä»¶ï¼Œç”¨äº Hadoop çš„é«˜æ•ˆå‹ç¼©ã€‚</li><li><strong>libzstd-devel</strong>: Zstandard å‹ç¼©åº“çš„å¼€å‘æ–‡ä»¶ï¼Œæä¾›å¦ä¸€ç§å‹ç¼©é€‰é¡¹ã€‚</li><li><strong>isa-l</strong>: Intel æä¾›çš„ä¸€å¥—é«˜æ•ˆæ•°æ®å¤„ç†åº“ï¼Œç”¨äºä¼˜åŒ– Hadoop çš„æ€§èƒ½ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install snappy-devel libzstd-devel autoconf automake libtool wget -y </span><br></pre></td></tr></table></figure><p>å®‰è£… nasm</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget https://www.nasm.us/pub/nasm/releasebuilds/2.15.05/nasm-2.15.05.tar.bz2</span><br><span class="line">tar -xvf nasm-2.15.05.tar.bz2</span><br><span class="line">cd nasm-2.15.05</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><p>å®‰è£… yasm</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz</span><br><span class="line">tar -xvf yasm-1.3.0.tar.gz</span><br><span class="line">cd yasm-1.3.0</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><p>å®‰è£… isa-l</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">git clone https://github.com/intel/isa-l</span><br><span class="line">cd isa-l/</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><h4 id="10-å®‰è£…-Java">10. å®‰è£… Java</h4><p>jdk <a href="https://www.oracle.com/cn/java/technologies/downloads/">ä¸‹è½½åœ°å€</a>ï¼Œé€‰æ‹© JDK8</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">tar zxvf jdk-8u421-linux-x64.tar.gz</span><br><span class="line">mv jdk1.8.0_421 jdk</span><br></pre></td></tr></table></figure><h4 id="11-å®‰è£…-Maven">11. å®‰è£… Maven</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget https://dlcdn.apache.org/maven/maven-3/3.9.8/binaries/apache-maven-3.9.8-bin.tar.gz</span><br><span class="line">tar zxvf apache-maven-3.9.8-bin.tar.gz</span><br><span class="line">mv apache-maven-3.9.8 maven</span><br><span class="line"></span><br><span class="line">vim /opt/maven/conf/settings.xml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®æœ¬åœ°ä»“åº“</span></span><br><span class="line">&lt;localRepository&gt;/opt/repository&lt;/localRepository&gt; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®é˜¿é‡Œäº‘æœåŠ¡å™¨é•œåƒ</span></span><br><span class="line">&lt;!-- é˜¿é‡Œäº‘ä»“åº“ --&gt;</span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">    &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;</span><br><span class="line">&lt;/mirror&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®JDK</span></span><br><span class="line">&lt;!-- javaç‰ˆæœ¬ --&gt; </span><br><span class="line">&lt;profile&gt;</span><br><span class="line">      &lt;id&gt;jdk-1.8&lt;/id&gt;</span><br><span class="line">      &lt;activation&gt;</span><br><span class="line">        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</span><br><span class="line">        &lt;jdk&gt;1.8&lt;/jdk&gt;</span><br><span class="line">      &lt;/activation&gt;</span><br><span class="line"></span><br><span class="line">      &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;</span><br><span class="line">      &lt;/properties&gt;</span><br><span class="line">&lt;/profile&gt;</span><br></pre></td></tr></table></figure><h4 id="12-é…ç½®ç¯å¢ƒå˜é‡">12. é…ç½®ç¯å¢ƒå˜é‡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line">export JAVA_HOME=/opt/jdk</span><br><span class="line">export MAVEN_HOME=/opt/maven</span><br><span class="line">export PATH=$JAVA_HOME/bin:$MAVEN_HOME/bin:$PATH </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ·æ–°é…ç½®</span></span><br><span class="line">source ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥javaå’Œmavenç‰ˆæœ¬</span></span><br><span class="line">java -version</span><br><span class="line">mvn -version</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘-Hadoop">ç¼–è¯‘ Hadoop</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget https://dlcdn.apache.org/hadoop/common/hadoop-3.4.0/hadoop-3.4.0-src.tar.gz</span><br><span class="line">tar zxvf hadoop-3.4.0-src.tar.gz</span><br><span class="line">cd /opt/hadoop-3.4.0-src</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>ä¿®æ”¹ pom æ–‡ä»¶</p><p><code>maven-enforcer-plugin</code> æ’ä»¶æ˜¯ä¸ºäº†æ£€æŸ¥å½“å‰ç³»ç»Ÿæ˜¯å¦æ­£ç¡®ï¼Œå¯èƒ½å› ä¸ºæˆ‘ç”¨çš„æ˜¯ <code>wsl2</code> çš„ CentOS7 ç³»ç»Ÿï¼Œæ— æ³•æ­£ç¡®è¯†åˆ«ï¼Œè¿™é‡Œæ ¹æ®çš„æƒ…å†µè‡ªè¡Œè¿›è¡Œä¿®æ”¹</p></div><p><strong>ä¿®æ”¹ maven-enforcer-plugin æ’ä»¶é…ç½®</strong></p><p>ä¿®æ”¹ <code>hadoop-3.4.0-src\hadoop-common-project\hadoop-common\pom.xml</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span> hadoop-common-project\hadoop-common\pom.xml</span><br><span class="line"></span><br><span class="line">          <span class="symbol">&lt;plugin&gt;</span></span><br><span class="line">            <span class="symbol">&lt;groupId&gt;</span>org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">            <span class="symbol">&lt;artifactId&gt;</span>maven-enforcer-plugin&lt;/artifactId&gt;</span><br><span class="line">            <span class="symbol">&lt;executions&gt;</span></span><br><span class="line">              <span class="symbol">&lt;execution&gt;</span></span><br><span class="line">                <span class="symbol">&lt;id&gt;</span>enforce-os&lt;/id&gt;</span><br><span class="line">                <span class="symbol">&lt;goals&gt;</span></span><br><span class="line">                  <span class="symbol">&lt;goal&gt;</span>enforce&lt;/goal&gt;</span><br><span class="line">                &lt;/goals&gt;</span><br><span class="line">                <span class="symbol">&lt;configuration&gt;</span></span><br><span class="line">                  <span class="symbol">&lt;rules&gt;</span></span><br><span class="line">                    <span class="symbol">&lt;requireOS&gt;</span></span><br><span class="line">                      <span class="symbol">&lt;family&gt;</span>mac&lt;/family&gt;</span><br><span class="line">                      <span class="symbol">&lt;family&gt;</span>unix&lt;/family&gt;</span><br><span class="line">                      <span class="symbol">&lt;message&gt;</span>native build <span class="keyword">only</span> supported <span class="keyword">on</span> Mac <span class="built_in">or</span> Unix&lt;/message&gt;</span><br><span class="line">                    &lt;/requireOS&gt;</span><br><span class="line">                  &lt;/rules&gt;</span><br><span class="line">                  <span class="symbol">&lt;fail&gt;</span>true&lt;/fail&gt;</span><br><span class="line">                  <span class="symbol">&lt;skip&gt;</span>true&lt;/skip&gt;  ### åœ¨é…ç½®ä¸­åŠ å…¥è¿™ä¸€è¡Œï¼Œæ¥è·³è¿‡è¿™ä¸ªæ’ä»¶</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">              &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">          &lt;/plugin&gt;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>hadoop-3.4.0-src\hadoop-mapreduce-project\hadoop-mapreduce-client\hadoop-mapreduce-client-nativetask\pom.xml</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span> hadoop-mapreduce-project\hadoop-mapreduce-client\hadoop-mapreduce-client-nativetask\pom.xml</span><br><span class="line"></span><br><span class="line">          <span class="symbol">&lt;plugin&gt;</span></span><br><span class="line">            <span class="symbol">&lt;groupId&gt;</span>org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">            <span class="symbol">&lt;artifactId&gt;</span>maven-enforcer-plugin&lt;/artifactId&gt;</span><br><span class="line">            <span class="symbol">&lt;executions&gt;</span></span><br><span class="line">              <span class="symbol">&lt;execution&gt;</span></span><br><span class="line">                <span class="symbol">&lt;id&gt;</span>enforce-os&lt;/id&gt;</span><br><span class="line">                <span class="symbol">&lt;goals&gt;</span></span><br><span class="line">                  <span class="symbol">&lt;goal&gt;</span>enforce&lt;/goal&gt;</span><br><span class="line">                &lt;/goals&gt;</span><br><span class="line">                <span class="symbol">&lt;configuration&gt;</span></span><br><span class="line">                  <span class="symbol">&lt;rules&gt;</span></span><br><span class="line">                    <span class="symbol">&lt;requireOS&gt;</span></span><br><span class="line">                      <span class="symbol">&lt;family&gt;</span>mac&lt;/family&gt;</span><br><span class="line">                      <span class="symbol">&lt;family&gt;</span>unix&lt;/family&gt;</span><br><span class="line">                      <span class="symbol">&lt;message&gt;</span>native build <span class="keyword">only</span> supported <span class="keyword">on</span> Mac <span class="built_in">or</span></span><br><span class="line">                        Unix&lt;/message&gt;</span><br><span class="line">                    &lt;/requireOS&gt;</span><br><span class="line">                  &lt;/rules&gt;</span><br><span class="line">                  <span class="symbol">&lt;fail&gt;</span>true&lt;/fail&gt;</span><br><span class="line">                  <span class="symbol">&lt;skip&gt;</span>true&lt;/skip&gt;  ### åœ¨é…ç½®ä¸­åŠ å…¥è¿™ä¸€è¡Œï¼Œæ¥è·³è¿‡è¿™ä¸ªæ’ä»¶</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">              &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">          &lt;/plugin&gt;</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘">ç¼–è¯‘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/hadoop-3.4.0-src</span><br><span class="line">mvn clean package -Pdist,native,src -DskipTests -Dtar -X -e</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘½ä»¤è¯´æ˜</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mvn æ„å»º java é¡¹ç›®</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">clean æ¸…ç†ä¹‹å‰çš„æ„å»ºï¼Œå¯çœç•¥</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">package ç¼–è¯‘é¡¹ç›®çš„æºä»£ç å¹¶æ‰“åŒ…æˆä¸€ä¸ª JAR æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-Pdist,native,src æ¿€æ´»æ„å»ºé…ç½®æ–‡ä»¶çš„é€‰é¡¹ distã€native å’Œ src æ˜¯ä¸‰ä¸ªä¸åŒçš„ Maven æ„å»ºé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dist ç”¨äºæ„å»ºåˆ†å‘ç‰ˆ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">native ç”¨äºæ„å»ºåŒ…å«æœ¬åœ°ä»£ç ï¼ˆC/C++ä»£ç ï¼‰çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">src ç”¨äºåŒ…å«æºç çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-DskipTests æ„å»ºè¿‡ç¨‹ä¸­è·³è¿‡è¿è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-Dtar æ„å»ºè¿‡ç¨‹ä¸­è¦ç”Ÿæˆä¸€ä¸ª.tar åŒ…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-X è°ƒè¯•è¾“å‡ºæ¨¡å¼,æœ‰åŠ©äºæ’æŸ¥é—®é¢˜</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-e è¯¦ç»†é”™è¯¯è¾“å‡ºæ¨¡å¼ï¼Œæ˜¾ç¤ºå®Œæ•´çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css&quot;&gt;&lt;script src=&quot;</summary>
        
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Linear Regression</title>
    <link href="https://blog.rishinyan.top/LinearRegression/"/>
    <id>https://blog.rishinyan.top/LinearRegression/</id>
    <published>2023-12-10T16:00:02.000Z</published>
    <updated>2024-11-29T06:25:29.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h2 id="Terminology-æœ¯è¯­">Terminology æœ¯è¯­</h2><p>x = â€œinputâ€ variable (feature)</p><p>y = â€œoutputâ€ variable (â€œtargetâ€ variable)</p><p>$\hat{y}$= prediction (estimated y)</p><p>m = number of training examples</p><p>(x, y) = single training example</p><p>$(x^{(i)},y^{(i)})$ =  $i^{th}$ training example. e.g. $(1^{st},2^{nd},3^{rd}â€¦)$</p><p>$w,b$: parameters, coefficients or weights</p><h2 id="Process-æµç¨‹">Process æµç¨‹</h2><p>training set -&gt; learning algorithm -&gt; function</p><p>x -&gt; module(function) -&gt; $\hat{y}$</p><h2 id="Univariate-linear-regression-å•å˜é‡çº¿æ€§å›å½’">Univariate linear regression å•å˜é‡çº¿æ€§å›å½’</h2><p>$f_{w,b}(x)=wx+b$</p><p>Linear regression with one variable(single feature x).<br>åªæœ‰ä¸€ä¸ªå˜é‡çš„çº¿æ€§å›å½’</p><h2 id="Cost-Function-squared-error-cost-function-æŸå¤±å‡½æ•°">Cost Function(squared error cost function) æŸå¤±å‡½æ•°</h2><p>To measure how well a choice of w, and b fits the training data.<br>è¡¡é‡é€‰æ‹©çš„ w å’Œ b å¯¹è®­ç»ƒæ•°æ®çš„æ‹Ÿåˆç¨‹åº¦ã€‚</p><p>$\hat{y}^{(i)}=f_{w,b}(x^{(i)})=wx^{(i)}+b$</p><p>$J(w,b) = \frac1{2m}\sum_{i=1}^m({\hat{y}^{(i)}}-y^{(i)})^2= \frac1{2m}\sum_{i=1}^m(f_{w,b}(x^{(i)})-y^{(i)})^2$</p><ul><li><p>$f_{w,b}(x^{(i)})$ is our prediction for example $i$ using parameters $w,b$. Â <br>$f_{w,b}(x^{(i)})$ æ˜¯ä½¿ç”¨å‚æ•° $w,b$ å¯¹ç¬¬ $i$ ä¸ªå®ä¾‹çš„é¢„æµ‹</p></li><li><p>$(f_{w,b}(x^{(i)}) -y^{(i)})^2$ is the squared difference between the target value and the prediction. Â <br>$(f_{w,b}(x^{(i)}) -y^{(i)})^2$ æ˜¯ç›®æ ‡å€¼ä¸é¢„æµ‹ä¹‹é—´çš„å¹³æ–¹å·®</p></li><li><p>These differences are summed over all the $m$ examples and divided by <code>2m</code> to produce the cost, $J(w,b)$.<br>è¿™äº›å·®å¼‚åœ¨æ‰€æœ‰ $m$ ä¸ªå®ä¾‹ä¸Šæ±‚å’Œï¼Œå¹¶é™¤ä»¥ <code>2m</code> å¾—åˆ°æˆæœ¬ $J(w,b)$</p></li></ul><p>Find w,b: ${\hat{y}}^{(i)}$ is close to $y^{(i)}$ for all $(x^{(i)},y^{(i)}).$<br>æ‰€æœ‰æ•°æ®ä¸­é¢„æµ‹yæ¥è¿‘çœŸå®yçš„wï¼Œbç³»æ•°</p><p>it measures the difference between the modelâ€™s predictions, and the actual true values for y.<br>å®ƒè¡¡é‡äº†æ¨¡å‹çš„é¢„æµ‹ä¸å®é™… y çš„çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_cost</span>(<span class="params">x, y, w, b</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®—çº¿æ€§å›å½’çš„æŸå¤±å‡½æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      x (ndarray (m,)): æ•°æ®é›†ï¼Œ mä¸ªå®ä¾‹ </span></span><br><span class="line"><span class="string">      y (ndarray (m,)): ç»“æœé›†</span></span><br><span class="line"><span class="string">      w,b (scalar)    : æ¨¡å‹å‚æ•°  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">        total_cost (float): ä½¿ç”¨wå’Œbä½œä¸ºçº¿æ€§å›å½’çš„å‚æ•°æ¥æ‹Ÿåˆxå’Œyä¸­çš„æ•°æ®ç‚¹çš„ä»£ä»·</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å®ä¾‹ä¸ªæ•°</span></span><br><span class="line">    m = x.shape[<span class="number">0</span>] </span><br><span class="line"></span><br><span class="line">    cost_sum = <span class="number">0</span> </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m): </span><br><span class="line">        f_wb = w * x[i] + b   </span><br><span class="line">        cost = (f_wb - y[i]) ** <span class="number">2</span>  </span><br><span class="line">        cost_sum = cost_sum + cost  </span><br><span class="line">    total_cost = (<span class="number">1</span> / (<span class="number">2</span> * m)) * cost_sum  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> total_cost</span><br></pre></td></tr></table></figure><h2 id="Gradient-descent-algorithm-æ¢¯åº¦ä¸‹é™ç®—æ³•">Gradient descent algorithm æ¢¯åº¦ä¸‹é™ç®—æ³•</h2><ul><li><p>Start with some w, b<br>ä»ä¸€äº›åˆå§‹çš„ w,b å¼€å§‹</p></li><li><p>Keep changing w,b Ü¾ to reduce J(w, b)<br>ä¸æ–­è°ƒæ•´ w,b ä»¥å‡å° J(w,b)</p></li><li><p>Until we settle at or near a minimum<br>ç›´åˆ°æˆ‘ä»¬ç¨³å®šåœ¨æˆ–æ¥è¿‘ä¸€ä¸ªåŒºåŸŸæœ€å°å€¼</p></li></ul><h3 id="implementing-å®ç°">implementing å®ç°</h3><p>$\begin{cases} w &amp;= w - \alpha \frac{\partial J(w,b)}{\partial w} \ b &amp;= b - \alpha \frac{\partial J(w,b)}{\partial b} \end{cases}$</p><p>$\alpha$ is learning rate,  $\frac{\partial J(w,b)}{\partial w}<br>$ is derivative<br>$\alpha$æ˜¯å­¦ä¹ ç‡, $\frac{\partial J(w,b)}{\partial w}$æ˜¯åå¯¼æ•°</p><p>Near a local minimum<br>å±€éƒ¨æœ€å°å€¼é™„è¿‘</p><ul><li><p>Derivative becomes smaller<br>å¯¼æ•°å˜å°</p></li><li><p>Update steps become smaller<br>æ›´æ–°æ­¥é•¿å˜å°</p></li></ul><p>repeat until convergence, where, parameters ğ‘¤, ğ‘ are updated simultaneously.<br>é‡å¤ç›´åˆ°æ”¶æ•›ï¼Œå…¶ä¸­ï¼Œå‚æ•°ğ‘¤, ğ‘åŒæ—¶æ›´æ–°ã€‚</p><p>Linear regression model: $f_{w,b}(x^{(i)}) = wx^{(i)} + b$</p><p>Cost function: $J(w,b) = \frac{1}{2m} \sum\limits_{i = 0}^{m-1} (f_{w,b}(x^{(i)}) - y^{(i)})^2$</p><p>$\frac{\partial J(w,b)}{\partial w} =\frac{1}{m} \sum\limits_{i = 0}^{m-1} (f_{w,b}(x^{(i)}) - y^{(i)})x^{(i)}$</p><p>$\frac{\partial J(w,b)}{\partial b} = \frac{1}{m} \sum\limits_{i = 0}^{m-1} (f_{w,b}(x^{(i)}) - y^{(i)})$</p><p>Here simultaniously means that you calculate the partial derivatives for all the parameters before updating any of the parameters.<br>è¿™é‡Œçš„ â€œåŒæ—¶â€ æ„å‘³ç€åœ¨æ›´æ–°ä»»ä½•å‚æ•°ä¹‹å‰ï¼ŒåŒæ—¶è®¡ç®—æ‰€æœ‰å‚æ•°çš„åå¯¼æ•°ã€‚</p><p><code>compute_gradient</code>  returns $\frac{\partial J(w,b)}{\partial w}$,$\frac{\partial J(w,b)}{\partial b}$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_gradient</span>(<span class="params">x, y, w, b</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®—çº¿æ€§å›å½’çš„æ¢¯åº¦</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      x (ndarray (m,)): æ•°æ®é›†ï¼Œ mä¸ªå®ä¾‹ </span></span><br><span class="line"><span class="string">      y (ndarray (m,)): ç»“æœé›†</span></span><br><span class="line"><span class="string">      w,b (scalar)    : æ¨¡å‹å‚æ•°  </span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">      dj_dw (scalar): costç›¸å¯¹äºå‚æ•°wçš„æ¢¯åº¦</span></span><br><span class="line"><span class="string">      dj_db (scalar): costç›¸å¯¹äºå‚æ•°bçš„æ¢¯åº¦      </span></span><br><span class="line"><span class="string">     &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®ä¾‹ä¸ªæ•°</span></span><br><span class="line">    m = x.shape[<span class="number">0</span>]    </span><br><span class="line">    dj_dw = <span class="number">0</span></span><br><span class="line">    dj_db = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):  </span><br><span class="line">        f_wb = w * x[i] + b </span><br><span class="line">        dj_dw_i = (f_wb - y[i]) * x[i] </span><br><span class="line">        dj_db_i = f_wb - y[i] </span><br><span class="line">        dj_db += dj_db_i</span><br><span class="line">        dj_dw += dj_dw_i </span><br><span class="line">    dj_dw = dj_dw / m </span><br><span class="line">    dj_db = dj_db / m </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dj_dw, dj_db</span><br></pre></td></tr></table></figure><p>Below <code>gradient_descent</code>, you will utilize this function to find optimal values of $w$ and $b$ on the training data.</p><p>$\begin{cases} w &amp;= w - \alpha \frac{\partial J(w,b)}{\partial w} \ b &amp;= b - \alpha \frac{\partial J(w,b)}{\partial b} \end{cases}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gradient_descent</span>(<span class="params">x, y, w_in, b_in, alpha, num_iters, gradient_function, num_iters</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ‰§è¡Œæ¢¯åº¦ä¸‹é™æ¥æ‹Ÿåˆå‚æ•° w å’Œ bã€‚é€šè¿‡é‡‡å–å­¦ä¹ ç‡ alpha è¿›è¡Œ num_iters æ¬¡æ¢¯åº¦æ­¥éª¤æ¥æ›´æ–° w å’Œ b</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      x (ndarray (m,))  : æ•°æ®é›†ï¼Œ mä¸ªå®ä¾‹  </span></span><br><span class="line"><span class="string">      y (ndarray (m,))  : ç»“æœé›†</span></span><br><span class="line"><span class="string">      w_in,b_in (scalar): æ¨¡å‹å‚æ•°çš„åˆå§‹å€¼  </span></span><br><span class="line"><span class="string">      alpha (float):     å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">      num_iters (int):   è¿è¡Œæ¢¯åº¦ä¸‹é™çš„è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="string">      gradient_function: è°ƒç”¨è¯¥å‡½æ•°ç”Ÿæˆgradient</span></span><br><span class="line"><span class="string">      num_iters (int)     : è¿è¡Œæ¢¯åº¦ä¸‹é™çš„è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      w (scalar): åœ¨è¿è¡Œæ¢¯åº¦ä¸‹é™åæ›´æ–°çš„å‚æ•°å€¼</span></span><br><span class="line"><span class="string">      b (scalar): åœ¨è¿è¡Œæ¢¯åº¦ä¸‹é™åæ›´æ–°çš„å‚æ•°å€¼</span></span><br><span class="line"><span class="string">      &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    b = b_in</span><br><span class="line">    w = w_in</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_iters):</span><br><span class="line">        <span class="comment"># è®¡ç®—æ¢¯åº¦å¹¶ä½¿ç”¨gradient_functionæ›´æ–°å‚æ•°</span></span><br><span class="line">        dj_dw, dj_db = gradient_function(x, y, w , b)     </span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ›´æ–°å‚æ•°</span></span><br><span class="line">        b = b - alpha * dj_db                            </span><br><span class="line">        w = w - alpha * dj_dw                            </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> w, b</span><br></pre></td></tr></table></figure><h2 id="Multiple-Linear-Regression-å¤šå…ƒçº¿æ€§å›å½’">Multiple Linear Regression å¤šå…ƒçº¿æ€§å›å½’</h2><h3 id="Terminology">Terminology</h3><p>$x_j=j^{th}$ feature</p><p>n = number of features</p><p>$\vec{x}^{(i)}$ = features of $i^{th}$  training example</p><p>$\vec{x}^{(i)}_j$= value of feature j in $i^{th}$ training example</p><h3 id="Model">Model</h3><p>$f_{\vec{w},b}(\vec{x})= \vec{w} \cdot \vec{x} + b= w_1x_1+w_2x_2+w_3x_3+Â·Â·Â·+w_nx_n+b$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">predict_single_loop</span>(<span class="params">x, w, b</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨çº¿æ€§å›å½’è¿›è¡Œå•ä¸€é¢„æµ‹on</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      x (ndarray): Shape (n,) å¸¦æœ‰å¤šç‰¹å¾çš„ä¾‹å­</span></span><br><span class="line"><span class="string">      w (ndarray): Shape (n,) æ¨¡å‹å‚æ•°    </span></span><br><span class="line"><span class="string">      b (scalar):  æ¨¡å‹å‚æ•°   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      p (scalar):  é¢„æµ‹å€¼</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    n = x.shape[<span class="number">0</span>]</span><br><span class="line">    p = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        p_i = x[i] * w[i]  </span><br><span class="line">        p = p + p_i         </span><br><span class="line">    p = p + b                </span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="comment"># We can make use of vector operations to speed up predictions.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">x, w, b</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨çº¿æ€§å›å½’è¿›è¡Œå•ä¸€é¢„æµ‹on</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      x (ndarray): Shape (n,) å¸¦æœ‰å¤šç‰¹å¾çš„ä¾‹å­</span></span><br><span class="line"><span class="string">      w (ndarray): Shape (n,) æ¨¡å‹å‚æ•°    </span></span><br><span class="line"><span class="string">      b (scalar):  æ¨¡å‹å‚æ•°   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      p (scalar):  é¢„æµ‹å€¼rediction</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    p = np.dot(x, w) + b     </span><br><span class="line">    <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure><h3 id="Cost-With-Multiple-Variables">Cost With Multiple Variables</h3><p>$J(\vec{w},b) = \frac{1}{2m} \sum\limits_{i = 1}^{m} (f_{\vec{w},b}(\vec{x}^{(i)}) - y^{(i)})^2$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_cost</span>(<span class="params">X, y, w, b</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®—æŸå¤±</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      X (ndarray (m,n)): Data, mä¸ªå®ä¾‹nä¸ªç‰¹å¾</span></span><br><span class="line"><span class="string">      y (ndarray (m,)) : ç›®æ ‡å€¼</span></span><br><span class="line"><span class="string">      w (ndarray (n,)) : æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string">      b (scalar)       : æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      cost (scalar): æŸå¤±å€¼</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    m = X.shape[<span class="number">0</span>]</span><br><span class="line">    cost = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):                                </span><br><span class="line">        f_wb_i = np.dot(X[i], w) + b           <span class="comment">#(n,)(n,) = scalar (see np.dot)</span></span><br><span class="line">        cost = cost + (f_wb_i - y[i])**<span class="number">2</span>       <span class="comment">#scalar</span></span><br><span class="line">    cost = cost / (<span class="number">2</span> * m)                      <span class="comment">#scalar    </span></span><br><span class="line">    <span class="keyword">return</span> cost</span><br></pre></td></tr></table></figure><h3 id="Gradient-descent">Gradient descent</h3><p>$w_j=w_j-\alpha\frac{\partial J(\vec{w},b)}{\partial{w_j}}$</p><p>$b=b-\alpha\frac{\partial{J(\vec{w},b)}}{\partial{b}}$</p><p>$\begin{cases}w_1=w_1-\alpha\frac{1}{m} \sum\limits_{i = 1}^{m} (f_{\vec{w},b}(\vec{x}^{(i)}) - y^{(i)})x_1^{(i)}\ .\ .\ .\ w_n=w_n-\alpha\frac{1}{m} \sum\limits_{i = 1}^{m} (f_{\vec{w},b}(\vec{x}^{(i)}) - y^{(i)})x_n^{(i)}\ b=b-\alpha\frac{1}{m} \sum\limits_{i = 1}^{m} (f_{\vec{w},b}(\vec{x}^{(i)}) - y^{(i)})\end{cases}$</p><p>n &gt;= 2, and simultaneously update $w_j$(for j = 1,â€¦,n) and b</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_gradient</span>(<span class="params">X, y, w, b</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®—çº¿æ€§å›å½’çš„æ¢¯åº¦</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      X (ndarray (m,n)): Data, mä¸ªå®ä¾‹nä¸ªç‰¹å¾</span></span><br><span class="line"><span class="string">      y (ndarray (m,)) : ç›®æ ‡å€¼</span></span><br><span class="line"><span class="string">      w (ndarray (n,)) : æ¨¡å‹å‚æ•°  </span></span><br><span class="line"><span class="string">      b (scalar)       : æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      dj_dw (ndarray (n,)): å¯¹äºå‚æ•° w çš„costå‡½æ•°æ¢¯åº¦ </span></span><br><span class="line"><span class="string">      dj_db (scalar):       å¯¹äºå‚æ•° b çš„costå‡½æ•°æ¢¯åº¦ </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    m,n = X.shape           <span class="comment">#(number of examples, number of features)</span></span><br><span class="line">    dj_dw = np.zeros((n,))</span><br><span class="line">    dj_db = <span class="number">0.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):                             </span><br><span class="line">        err = (np.dot(X[i], w) + b) - y[i]   </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):                         </span><br><span class="line">            dj_dw[j] = dj_dw[j] + err * X[i, j]    </span><br><span class="line">        dj_db = dj_db + err                        </span><br><span class="line">    dj_dw = dj_dw / m                                </span><br><span class="line">    dj_db = dj_db / m                                </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dj_db, dj_dw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradient_descent</span>(<span class="params">X, y, w_in, b_in, cost_function, gradient_function, alpha, num_iters</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ‰§è¡Œæ‰¹é‡æ¢¯åº¦ä¸‹é™ä»¥å­¦ä¹  w å’Œ bã€‚é€šè¿‡é‡‡å– num_iters æ­¥é•¿ä¸º learning rate çš„æ¢¯åº¦æ­¥éª¤æ¥æ›´æ–° w å’Œ b</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      X (ndarray (m,n))   : Data, mä¸ªå®ä¾‹nä¸ªç‰¹å¾</span></span><br><span class="line"><span class="string">      y (ndarray (m,))    : ç›®æ ‡å€¼</span></span><br><span class="line"><span class="string">      w_in (ndarray (n,)) : åˆå§‹æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string">      b_in (scalar)       : åˆå§‹æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string">      cost_function       : è®¡ç®—costçš„å‡½æ•°</span></span><br><span class="line"><span class="string">      gradient_function   : è®¡ç®—æ¢¯åº¦çš„å‡½æ•°</span></span><br><span class="line"><span class="string">      alpha (float)       : å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">      num_iters (int)     : è¿è¡Œæ¢¯åº¦ä¸‹é™çš„è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      w (ndarray (n,)) : æ›´æ–°åçš„å‚æ•°ç»“æœ </span></span><br><span class="line"><span class="string">      b (scalar)       : æ›´æ–°åçš„å‚æ•°ç»“æœ</span></span><br><span class="line"><span class="string">      &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    w = copy.deepcopy(w_in)  <span class="comment">#åœ¨å‡½æ•°å†…éƒ¨é¿å…ä¿®æ”¹å…¨å±€å˜é‡ w</span></span><br><span class="line">    b = b_in</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_iters):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°å‚æ•°</span></span><br><span class="line">        dj_db,dj_dw = gradient_function(X, y, w, b)   <span class="comment">##None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ›´æ–°å‚æ•°ä½¿ç”¨ w, b, alpha and gradient</span></span><br><span class="line">        w = w - alpha * dj_dw               <span class="comment">##None</span></span><br><span class="line">        b = b - alpha * dj_db               <span class="comment">##None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> w, b <span class="comment"># è¿”å›æœ€ç»ˆ w,b</span></span><br></pre></td></tr></table></figure><h2 id="Normal-equation-æ­£è§„æ–¹ç¨‹">Normal equation æ­£è§„æ–¹ç¨‹</h2><ul><li>only for linear regression</li><li>solve for w,b without iterations</li></ul><p>Disadvantage:</p><ul><li>dosenâ€™t generalize to other learning algorithms</li><li>slow when number of features is large (&gt; 10000)</li></ul><h2 id="Feature-scaling-ç‰¹å¾ç¼©æ”¾">Feature scaling ç‰¹å¾ç¼©æ”¾</h2><p>Feature scaling, essentially dividing each positive feature by its maximum value, or more generally, rescale each feature by both its minimum and maximum values using (x-min)/(max-min).</p><p>aim for about -1 &lt;= $x_j$ &lt;= 1 for each feature $x_j$</p><h3 id="Mean-normalization-å‡å€¼å½’ä¸€åŒ–">Mean normalization å‡å€¼å½’ä¸€åŒ–</h3><p>$x_i := \dfrac{x_i - \mu_i}{max - min}$</p><h3 id="Z-score-normalization-Z-scoreå½’ä¸€åŒ–">Z-score normalization Z-scoreå½’ä¸€åŒ–</h3><p>After z-score normalization, all features will have a mean of 0 and a standard deviation of 1.</p><p>$x^{(i)}_j = \dfrac{x^{(i)}_j - \mu_j}{\sigma_j} \tag{4}$</p><p>where $j$ selects a feature or a column in the $\mathbf{X}$ matrix. $Âµ_j$ is the mean of all the values for feature (j) and $\sigma_j$ is the standard deviation of feature (j).</p><p><strong>Implementation Note:</strong> When normalizing the features, it is important to store the values used for normalization - the mean value and the standard deviation used for the computations.</p><p>Given a new x value, we must first normalize x using the mean and standard deviation that we had previously computed from the training set.</p>]]></content>
    
    
    <summary type="html">çº¿æ€§å›å½’</summary>
    
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://blog.rishinyan.top/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="ç›‘ç£å­¦ä¹ " scheme="https://blog.rishinyan.top/tags/%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>Jupyter Notebook å®‰è£…</title>
    <link href="https://blog.rishinyan.top/JupyterNotebookInstallation/"/>
    <id>https://blog.rishinyan.top/JupyterNotebookInstallation/</id>
    <published>2023-12-10T16:00:01.000Z</published>
    <updated>2024-11-29T06:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h2 id="ä»‹ç»">ä»‹ç»</h2><p>Jupyter Notebook æ˜¯ä¸€ä¸ªå¼€æºçš„äº¤äº’å¼è®¡ç®—ç¯å¢ƒï¼Œæœ€åˆæ˜¯ä½œä¸ºIPythoné¡¹ç›®çš„ä¸€éƒ¨åˆ†å¼€å‘çš„ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåŸºäºç½‘é¡µçš„ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºå’Œå…±äº«åŒ…å«ä»£ç ã€æ–‡æœ¬ã€å›¾åƒã€å…¬å¼å’Œå¯è§†åŒ–å†…å®¹çš„æ–‡æ¡£ã€‚</p><p>Anacondaç›´æ¥å®‰è£…ä¸Dockerå®‰è£…</p><h2 id="å®‰è£…ç¯å¢ƒ">å®‰è£…ç¯å¢ƒ</h2><p>centos 7.9<br>docker 24.0.7</p><h2 id="Anacondaå®‰è£…">Anacondaå®‰è£…</h2><p><a href="https://www.anaconda.com/download#downloads">Anacondaä¸‹è½½åœ°å€</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.anaconda.com/archive/Anaconda3-2023.09-0-Linux-x86_64.sh</span><br><span class="line"><span class="built_in">chmod</span> +x Anaconda3-2023.09-0-Linux-x86_64.sh</span><br><span class="line">./Anaconda3-2023.09-0-Linux-x86_64.sh</span><br></pre></td></tr></table></figure><p>é…ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line"><span class="comment"># åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ </span></span><br><span class="line"><span class="comment"># /opt/anaconda3æ˜¯ä½ å®‰è£…Anacondaçš„è·¯å¾„ï¼Œå¯æ›¿æ¢</span></span><br><span class="line"><span class="built_in">export</span> ANACONDA=/opt/anaconda3</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ANACONDA</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨:wqä¿å­˜æ–‡ä»¶å,åˆ·æ–°é…ç½®</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨Jupyter-Notebook">å¯åŠ¨Jupyter Notebook</h3><p>ç”Ÿæˆjupyter é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br><span class="line"><span class="comment"># ä¿®æ”¹jupyterçš„å·¥ä½œè·¯å¾„</span></span><br><span class="line">vim ~/.jupyter/jupyter_notebook_config.py</span><br><span class="line"><span class="comment"># å°†c.NotebookApp.notebook_dirçš„å€¼ä¿®æ”¹ä¸ºä½ çš„å·¥ä½œè·¯å¾„</span></span><br><span class="line">c.NotebookApp.notebook_dir = <span class="string">&#x27;/opt/jupyter&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼ˆ0.0.0.0ï¼‰ï¼Œå¹¶æŒ‡å®šç«¯å£å·ä¸º 8888ï¼ŒåŒæ—¶å…³é—­é»˜è®¤çš„ Web æµè§ˆå™¨æ‰“å¼€é€‰é¡¹ï¼ˆ--no-browserï¼‰</span></span><br><span class="line">jupyter notebook --port=8888 --ip=0.0.0.0 --no-browser</span><br></pre></td></tr></table></figure><p>è·å–åˆ°jupyterçš„web</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[I 15:21:48.611 NotebookApp] Jupyter Notebook 6.5.4 is running at:</span><br><span class="line">[I 15:21:48.611 NotebookApp] http://localhost:8888/?token=xxxxxxxxxxxxxxx</span><br><span class="line">[I 15:21:48.611 NotebookApp]  or http://127.0.0.1:8888/?token=xxxxxxxxxxxxxxx</span><br><span class="line">[I 15:21:48.611 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br></pre></td></tr></table></figure><h2 id="Dockeræ„å»ºjupyterlab">Dockeræ„å»ºjupyterlab</h2><p>é•œåƒå¯æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œtensorflowçš„ç‰ˆæœ¬ã€‚cudaä¸cudnnä½¿ç”¨æœ¬åœ°å·²ç»å®‰è£…å¥½çš„åº“ï¼Œè¯·ç¡®ä¿å·²ç»å®‰è£…äº†æ˜¾å¡ç›¸å…³é©±åŠ¨ï¼Œcudaä¸cudnnç­‰ï¼Œå¹¶å®‰è£…nvidia-container-toolkitï¼Œé…ç½®daemon.jsonæ–‡ä»¶ç›¸å…³runtimeè®¾ç½®ã€‚</p><h3 id="ç¼–è¯‘pythonè„šæœ¬">ç¼–è¯‘pythonè„šæœ¬</h3><p><a href="http://setup.python.sh">setup.python.sh</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line">set -xe</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line">VERSION=$1</span><br><span class="line">PYTHON=$2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Install Python packages <span class="keyword">for</span> this container<span class="string">&#x27;s version</span></span></span><br><span class="line">yum -y update</span><br><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install gcc openssl-devel bzip2-devel libffi-devel wget make sqlite-devel</span><br><span class="line">yum clean all</span><br><span class="line"></span><br><span class="line">wget https://www.python.org/ftp/python/$PYTHON/Python-$PYTHON.tgz</span><br><span class="line">tar xzf Python-$PYTHON.tgz</span><br><span class="line">cd Python-$PYTHON</span><br><span class="line">./configure --enable-optimizations</span><br><span class="line">make altinstall</span><br><span class="line">cd ..</span><br><span class="line">rm -rf Python-$PYTHON Python-$PYTHON.tgz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Setup links for TensorFlow to compile.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Referenced in devel.usertools/*.bazelrc</span></span></span><br><span class="line">ln -sf /usr/local/bin/$VERSION /usr/bin/python3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ln -sf /usr/local/bin/$VERSION /usr/bin/python</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Python 3.10 include headers fix:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">sysconfig.get_path(&#x27;</span>include<span class="string">&#x27;) incorrectly points to /usr/local/include/python</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">map /usr/include/python3.10 to /usr/local/include/python3.10</span></span></span><br><span class="line">if [[ ! -f &quot;/usr/local/include/$VERSION&quot; ]]; then</span><br><span class="line">  ln -sf /usr/include/$VERSION /usr/local/include/$VERSION</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Install pip</span></span></span><br><span class="line">curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</span><br><span class="line">python3 get-pip.py</span><br><span class="line">python3 -m pip install --no-cache-dir --upgrade pip</span><br><span class="line">rm -f get-pip.py</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…jupyterlabè„šæœ¬">å®‰è£…jupyterlabè„šæœ¬</h3><p><a href="http://setup.jupyter.sh">setup.jupyter.sh</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">pip uninstall urllib3</span><br><span class="line">pip install urllib3==1.26.7</span><br><span class="line">jupyter serverextension enable --py jupyter_http_over_ws</span><br><span class="line"></span><br><span class="line">mkdir /.local</span><br><span class="line">chmod a+rwx /.local</span><br><span class="line"></span><br><span class="line">yum remove -y wget</span><br><span class="line"></span><br><span class="line">python3 -m ipykernel.kernelspec</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…jupyterlabæ‰€éœ€">å®‰è£…jupyterlabæ‰€éœ€</h3><p>jupyter.requirements.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jupyterlab</span><br><span class="line">matplotlib</span><br><span class="line">jupyter_http_over_ws</span><br><span class="line">pysqlite3</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºimage">æ„å»ºimage</h3><p>jupyterlab.Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:centos7 as base</span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> TZ <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> PYTHON_VERSION=python3.<span class="number">7</span></span><br><span class="line"><span class="keyword">ARG</span> P_VERSION=<span class="number">3.7</span>.<span class="number">10</span></span><br><span class="line"><span class="keyword">ARG</span> TENSORFLOW_PACKAGE=tensorflow==<span class="number">2.6</span>.<span class="number">5</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> setup.python.sh /setup.python.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> /setup.python.sh <span class="variable">$PYTHON_VERSION</span> <span class="variable">$P_VERSION</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir <span class="variable">$&#123;TENSORFLOW_PACKAGE&#125;</span> -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;export LD_LIBRARY_PATH=/usr/local/cuda/lib64&#x27;</span> &gt;&gt; ~/.bashrc</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">source</span> ~/.bashrc</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workdir</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> base as jupyterlab</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> jupyter.requirements.txt /jupyter.requirements.txt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> setup.jupyter.sh /setup.jupyter.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> python3 -m pip install --no-cache-dir -r /jupyter.requirements.txt -U</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> /setup.jupyter.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;source ~/.bashrc &amp;&amp; jupyter lab --notebook-dir=/workdir --ip 0.0.0.0 --no-browser --allow-root&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆimage</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chmod +x setup.python.sh setup.jupyter.sh</span><br><span class="line">docker build --target=jupyterlab --build-arg TENSORFLOW_PACKAGE=tensorflow==2.6.5 --build-arg PYTHON_VERSION=python3.7 --build-arg P_VERSION=3.7.10 -t jupyterlab:latest -f jupyterlab.Dockerfile .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--target é€‰æ‹©FROMæ„å»ºé•œåƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--build-arg dockerfileä¸­å‚æ•°</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t ç”Ÿæˆé•œåƒå</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f é•œåƒæ–‡ä»¶å</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">. å½“å‰ç›®å½•</span></span><br></pre></td></tr></table></figure><h3 id="è¿è¡ŒContainer">è¿è¡ŒContainer</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --gpus all --rm -v /usr/local/cuda-11.2/:/usr/local/cuda -p 8888:8888 --name jupyterlab jupyterlab:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--gpus éœ€è¦å¯¹dockerçš„daemon.jsonæ–‡ä»¶ä¸­é…ç½®<span class="string">&quot;default-runtime&quot;</span>: <span class="string">&quot;nvidia&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v æŒ‡å®šå½“å‰ç³»ç»Ÿä¸­çš„cudaç›®å½•</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ">å‚è€ƒ</h2><p><a href="https://github.com/tensorflow/build/tree/master/tensorflow_runtime_dockerfiles">build/tensorflow_runtime_dockerfiles at master Â· tensorflow/build (github.com)</a></p><p><a href="https://stackoverflow.com/questions/76855634/jetson-orin-nx-nvidia-container-runtime-not-utilizing-gpu">kubernetes - Jetson Orin NX nvidia-container-runtime not utilizing GPU - Stack Overflow</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css&quot;&gt;&lt;script src=&quot;</summary>
        
      
    
    
    
    
    <category term="jupyter" scheme="https://blog.rishinyan.top/tags/jupyter/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes å®‰è£…</title>
    <link href="https://blog.rishinyan.top/Kubernetes/"/>
    <id>https://blog.rishinyan.top/Kubernetes/</id>
    <published>2023-11-10T16:00:00.000Z</published>
    <updated>2025-03-14T07:58:06.653Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1>Kubernetes</h1><h2 id="ä»‹ç»">ä»‹ç»</h2><p>ä½¿ç”¨ kubeadm å®‰è£… k8s 1.31.2</p><p>container runtime é€‰æ‹© containerdæˆ–è€…cri-o</p><p>å®‰è£…ç½‘ç»œæ’ä»¶ calicoï¼ŒèŠ‚ç‚¹ç›‘æ§ Metrics-Server</p><h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2><table><thead><tr><th style="text-align:center">èŠ‚ç‚¹</th><th style="text-align:center">ç³»ç»Ÿ</th><th style="text-align:center">IP</th></tr></thead><tbody><tr><td style="text-align:center">master</td><td style="text-align:center">centos7.9</td><td style="text-align:center">192.168.157.128</td></tr><tr><td style="text-align:center">node1</td><td style="text-align:center">centos7.9</td><td style="text-align:center">192.168.157.129</td></tr></tbody></table><h2 id="åŸºæœ¬é…ç½®">åŸºæœ¬é…ç½®</h2><div class="note primary flat"><p>ä»¥ä¸‹æ“ä½œè‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½è¿›è¡Œæ“ä½œ</p></div><h3 id="å®‰è£…æ‰€éœ€è½¯ä»¶">å®‰è£…æ‰€éœ€è½¯ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CentOS7 æ“ä½œ</span></span><br><span class="line">yum -y install wget device-mapper-persistent-data lvm2 chrony sshpass ipvsadm ipset sysstat conntrack libseccomp curl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu æ“ä½œ</span></span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y lvm2 chrony sshpass ipvsadm ipset sysstat conntrack apt-transport-https curl</span><br></pre></td></tr></table></figure><h3 id="å…³é—­é˜²ç«å¢™">å…³é—­é˜²ç«å¢™</h3><p>åœ¨æŸäº› Kubernetes ç»„ä»¶æˆ–æ’ä»¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æƒé™é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡Œæ—§ç‰ˆæœ¬æ—¶ã€‚å…³é—­ SELinux å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p><p>ubuntu å¿½ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl disable --now firewalld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­ SELinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i &#x27;s#SELINUX=enforcing#SELINUX=permissive#g&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="å…³é—­-Swap">å…³é—­ Swap</h3><ul><li><strong>ä¿è¯èµ„æºéš”ç¦»</strong>ï¼šKubernetes ä½¿ç”¨ cgroups æ¥é™åˆ¶æ¯ä¸ªå®¹å™¨çš„èµ„æºä½¿ç”¨ï¼Œå¦‚ CPU å’Œå†…å­˜ã€‚å¦‚æœå¯ç”¨ swapï¼Œå®¹å™¨å¯èƒ½ä¼šè¶…è¿‡å…¶åˆ†é…çš„å†…å­˜é™åˆ¶ï¼Œé€šè¿‡ swap å ç”¨æ›´å¤šçš„å†…å­˜èµ„æºï¼Œå¯¼è‡´ä¸å‡†ç¡®çš„èµ„æºéš”ç¦»ã€‚</li><li><strong>ç¨³å®šæ€§</strong>ï¼šåœ¨å¯ç”¨ swap æ—¶ï¼Œå¯èƒ½ä¼šå¼•èµ·è°ƒåº¦çš„ä¸ç¨³å®šï¼Œå®¹å™¨åœ¨é«˜è´Ÿè½½æ—¶å®¹æ˜“è¢«æ€æ­»ï¼Œå½±å“åº”ç”¨çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</li><li><strong>Kubelet è¦æ±‚</strong>ï¼šKubelet é»˜è®¤ä¼šæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦ç¦ç”¨äº† swapï¼Œè‹¥æœªå…³é—­ï¼Œåˆ™ä¼šæ‹’ç»å¯åŠ¨ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬é€‰æ‹©å…³é—­ swapã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># å…³é—­äº¤æ¢åˆ†åŒº</span><br><span class="line">sudo sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br><span class="line">sudo swapoff -a &amp;&amp; sysctl -w vm.swappiness=0</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</h3><p>ç”¨äºæŒ‡å®šä¸ç”± NetworkManager ç®¡ç†çš„è®¾å¤‡ï¼Œå¯ä»¥å°†ç‰¹å®šçš„æ¥å£æ’é™¤åœ¨ NetworkManager çš„ç®¡ç†èŒƒå›´ä¹‹å¤–ï¼Œä»¥ä¾¿å…¶ä»–å·¥å…·æˆ–è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°ç®¡ç†å’Œé…ç½®è¿™äº›æ¥å£ã€‚</p><p>ubuntu å¿½ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/NetworkManager/conf.d/calico.conf &lt;&lt; EOF </span><br><span class="line">[keyfile]</span><br><span class="line">unmanaged-devices=interface-name:cali*;interface-name:tunl*</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart NetworkManager</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">interface-name:cali*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¡¨ç¤ºä»¥ <span class="string">&quot;cali&quot;</span> å¼€å¤´çš„æ¥å£åç§°è¢«æ’é™¤åœ¨ NetworkManager ç®¡ç†ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œ<span class="string">&quot;cali0&quot;</span>, <span class="string">&quot;cali1&quot;</span> ç­‰æ¥å£ä¸å— NetworkManager ç®¡ç†ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">interface-name:tunl*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¡¨ç¤ºä»¥ <span class="string">&quot;tunl&quot;</span> å¼€å¤´çš„æ¥å£åç§°è¢«æ’é™¤åœ¨ NetworkManager ç®¡ç†ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œ<span class="string">&quot;tunl0&quot;</span>, <span class="string">&quot;tunl1&quot;</span> ç­‰æ¥å£ä¸å— NetworkManager ç®¡ç†ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="è¿›è¡Œæ—¶é—´åŒæ­¥">è¿›è¡Œæ—¶é—´åŒæ­¥</h3><p>master æ“ä½œ</p><p>å°†ä¸‹æ–¹ <code>192.168.157.0/24</code> æ¢ä¸ºä½ ä¸»æœºæ‰€åœ¨çš„ç½‘æ®µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/chrony.conf &lt;&lt; EOF </span><br><span class="line">pool ntp.aliyun.com iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">allow 192.168.157.0/24 # ç½‘æ®µèŒƒå›´å†…çš„ä¸»æœºä¸chronyè¿›è¡Œæ—¶é—´åŒæ­¥</span><br><span class="line">local stratum 10</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart chronyd ; systemctl enable chronyd </span><br></pre></td></tr></table></figure><p>node èŠ‚ç‚¹æ“ä½œ</p><p>å°†ä¸‹æ–¹ <code>192.168.157.128</code> ä¿®æ”¹ä¸ºæœåŠ¡ç«¯èŠ‚ç‚¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/chrony.conf &lt;&lt; EOF </span><br><span class="line">pool 192.168.157.128 iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart chronyd ; systemctl enable chronyd </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯</span></span><br><span class="line">chronyc sources -v</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-ulimit">é…ç½® ulimit</h3><ul><li><strong>é™åˆ¶æ–‡ä»¶æè¿°ç¬¦æ•°é‡</strong>ï¼šKubernetes ä¸­çš„èŠ‚ç‚¹å’Œå®¹å™¨å¯èƒ½éœ€è¦æ‰“å¼€å¤§é‡æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¾‹å¦‚æ—¥å¿—æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ã€‚å¦‚æœæœªè®¾ç½®è¶³å¤Ÿé«˜çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ <code>too many open files</code> é”™è¯¯ï¼Œå½±å“æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚</li><li><strong>æ§åˆ¶è¿›ç¨‹æ•°</strong>ï¼šåœ¨é«˜è´Ÿè½½çš„ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¤§é‡è¿›ç¨‹å¯åŠ¨ï¼ˆå¦‚å¾®æœåŠ¡ç¯å¢ƒä¸­çš„å¤šä¸ª podï¼‰ï¼Œè¿™æ—¶éœ€è¦å¯¹è¿›ç¨‹æ•°é™åˆ¶è¿›è¡Œåˆç†é…ç½®ï¼Œä»¥é˜²æ­¢ç³»ç»Ÿå› è¿›ç¨‹æ•°è¿‡å¤šè€Œå´©æºƒã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ulimit -SHn 65535</span><br><span class="line">cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF</span><br><span class="line">* soft nofile 655360</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 655350</span><br><span class="line">* hard nproc 655350</span><br><span class="line">* seft memlock unlimited</span><br><span class="line">* hard memlock unlimitedd</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">soft nofile 655360</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">softè¡¨ç¤ºè½¯é™åˆ¶ï¼Œnofileè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œé»˜è®¤å€¼ä¸º1024ã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º655360ï¼Œå³ä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ä¸º655360ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hard nofile 131072</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hardè¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚nofileè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œé»˜è®¤å€¼ä¸º4096ã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º131072ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§æ–‡ä»¶æ•°ä¸º131072ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">soft <span class="built_in">nproc</span> 655350</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">softè¡¨ç¤ºè½¯é™åˆ¶ï¼Œ<span class="built_in">nproc</span>è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º30720ã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º655350ï¼Œå³ä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ä¸º655350ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hard <span class="built_in">nproc</span> 655350</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hardè¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚<span class="built_in">nproc</span>è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º4096ã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º655350ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§è¿›ç¨‹æ•°ä¸º655350ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">seft memlock unlimited</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">seftè¡¨ç¤ºè½¯é™åˆ¶ï¼Œmemlockè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯é”å®šåœ¨RAMä¸­çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ä¸º64 KBã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸ºunlimitedï¼Œå³ä¸€ä¸ªè¿›ç¨‹å¯é”å®šçš„æœ€å¤§å†…å­˜ä¸ºæ— é™åˆ¶ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hard memlock unlimited</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hardè¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚memlockè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯é”å®šåœ¨RAMä¸­çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ä¸º64 KBã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸ºunlimitedï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å†…å­˜é”å®šä¸ºæ— é™åˆ¶ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="å‡çº§å†…æ ¸è‡³4-18ç‰ˆæœ¬ä»¥ä¸Šï¼ˆå¯é€‰ï¼‰">å‡çº§å†…æ ¸è‡³4.18ç‰ˆæœ¬ä»¥ä¸Šï¼ˆå¯é€‰ï¼‰</h3><ul><li><strong>å¢å¼ºçš„å®¹å™¨æ”¯æŒ</strong>ï¼šå†…æ ¸ 4.18 å¼•å…¥äº†å¯¹ <code>cgroup v2</code>ã€<code>eBPF</code> ç­‰ç‰¹æ€§çš„æ”¹è¿›ï¼Œè¿™äº›ç‰¹æ€§èƒ½å¤Ÿä¼˜åŒ– Kubernetes çš„èµ„æºç®¡ç†å’Œç›‘æ§ã€‚ä½¿ç”¨ <code>cgroup v2</code> å¯ä»¥æ›´å¥½åœ°éš”ç¦»å’Œç®¡ç†å®¹å™¨èµ„æºï¼Œå‡å°‘èµ„æºäº‰ç”¨ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåœ¨é«˜è´Ÿè½½ç¯å¢ƒä¸‹ï¼Œæ–°å†…æ ¸å¼•å…¥çš„ç½‘ç»œå’Œå­˜å‚¨ä¼˜åŒ–å¯ä»¥æ˜¾è‘—æå‡ Kubernetes é›†ç¾¤çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œ<code>IPVS</code> åœ¨ 4.18 åŠæ›´é«˜ç‰ˆæœ¬ä¸­æœ‰æ›´å¥½çš„æ”¯æŒï¼Œå¯æé«˜æœåŠ¡è´Ÿè½½å‡è¡¡çš„æ•ˆç‡ã€‚</li><li><strong>å®‰å…¨å¢å¼º</strong>ï¼šé«˜ç‰ˆæœ¬å†…æ ¸åŒ…å«ä¸€äº›å®‰å…¨è¡¥ä¸ï¼Œæœ‰åŠ©äºå‡å°‘é›†ç¾¤åœ¨é¢å¯¹ç°ä»£æ¼æ´ï¼ˆå¦‚ Meltdownã€Spectreï¼‰æ—¶çš„é£é™©ï¼Œå¢å¼ºç³»ç»Ÿçš„æ•´ä½“å®‰å…¨æ€§ã€‚</li></ul><p>ubuntuå¿½ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ å¯ç”¨æº</span></span><br><span class="line">yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm -y </span><br><span class="line">sed -i &quot;s@mirrorlist@#mirrorlist@g&quot; /etc/yum.repos.d/elrepo.repo </span><br><span class="line">sed -i &quot;s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g&quot; /etc/yum.repos.d/elrepo.repo </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…æœ€æ–°çš„å†…æ ¸</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ç¨³å®šç‰ˆ kernel-ml   å¦‚éœ€æ›´æ–°é•¿æœŸç»´æŠ¤ç‰ˆæœ¬ kernel-lt</span>  </span><br><span class="line">yum -y --enablerepo=elrepo-kernel  install  kernel-ml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å·²å®‰è£…é‚£äº›å†…æ ¸</span></span><br><span class="line">rpm -qa | grep kernel</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é»˜è®¤å†…æ ¸</span></span><br><span class="line">grubby --default-kernel</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è‹¥ä¸æ˜¯æœ€æ–°çš„ä½¿ç”¨å‘½ä»¤è®¾ç½®</span></span><br><span class="line">grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯ç”Ÿæ•ˆ</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-ipvsadm">å®‰è£… ipvsadm</h3><ul><li><p><strong>é«˜æ€§èƒ½</strong>ï¼šIPVSï¼ˆIP Virtual Serverï¼‰ç›¸æ¯”é»˜è®¤çš„Â <code>iptables</code>Â æ¨¡å¼åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œé€‚åˆå¤§å‹é›†ç¾¤ã€‚</p></li><li><p><strong>ä½å»¶è¿Ÿ</strong>ï¼šIPVS ä½¿ç”¨ Linux å†…æ ¸çº§åˆ«çš„è´Ÿè½½å‡è¡¡å®ç°ï¼Œå»¶è¿Ÿæ›´ä½ï¼Œæ”¯æŒè½®è¯¢ã€æœ€å°è¿æ¥æ•°ç­‰å¤šç§è°ƒåº¦ç®—æ³•ï¼Œæå‡æœåŠ¡è®¿é—®æ•ˆç‡ã€‚</p></li><li><p><strong>ç®¡ç†å’ŒæŸ¥çœ‹ IPVS è§„åˆ™</strong>ï¼šè™½ç„¶ IPVS æ¨¡å¼æœ¬èº«ä¸ä¾èµ–Â <code>ipvsadm</code>Â è¿è¡Œï¼Œä½†Â <code>ipvsadm</code>Â æä¾›äº†æŸ¥çœ‹å’Œç®¡ç† IPVS è§„åˆ™çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡Â <code>ipvsadm -Ln</code>Â å‘½ä»¤åˆ—å‡ºå½“å‰çš„ IPVS è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œå¸®åŠ©è¿ç»´äººå‘˜æ’æŸ¥ç½‘ç»œé—®é¢˜ã€‚</p></li><li><p><strong>ç›‘æ§ IPVS çŠ¶æ€</strong>ï¼šå¯ä»¥æŸ¥çœ‹å½“å‰è¿æ¥æ•°ã€è·¯ç”±ç­‰ä¿¡æ¯ï¼Œä¾¿äºè°ƒä¼˜å’Œç›‘æ§è´Ÿè½½å‡è¡¡çŠ¶æ€ã€‚</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">yum install ipvsadm ipset sysstat conntrack libseccomp -y</span><br><span class="line">apt install ipvsadm ipset sysstat conntrack -y</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/modules-load.d/ipvs.conf &lt;&lt;EOF </span><br><span class="line">ip_vs</span><br><span class="line">ip_vs_rr</span><br><span class="line">ip_vs_wrr</span><br><span class="line">ip_vs_sh</span><br><span class="line">nf_conntrack</span><br><span class="line">ip_tables</span><br><span class="line">ip_set</span><br><span class="line">xt_set</span><br><span class="line">ipt_set</span><br><span class="line">ipt_rpfilter</span><br><span class="line">ipt_REJECT</span><br><span class="line">ipip</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡è½½æ¨¡å—</span></span><br><span class="line">systemctl restart systemd-modules-load.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥é…ç½®</span></span><br><span class="line">lsmod | grep -e ip_vs -e nf_conntrack</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip_vs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IPVS æ˜¯ Linux å†…æ ¸ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºå®ç°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚å®ƒé€šè¿‡åœ¨å‰ç«¯ä»£ç†æœåŠ¡å™¨ä¸Šåˆ†å‘ä¼ å…¥è¯·æ±‚åˆ°åç«¯å®é™…æœåŠ¡å™¨ä¸Šï¼Œæä¾›äº†é«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„ç½‘ç»œæœåŠ¡ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ip_vs_rr</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IPVS çš„ä¸€ç§è°ƒåº¦ç®—æ³•ä¹‹ä¸€ï¼Œä½¿ç”¨è½®è¯¢æ–¹å¼åˆ†å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰é¡ºåºä¾æ¬¡åˆ†å‘ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ip_vs_wrr</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IPVS çš„ä¸€ç§è°ƒåº¦ç®—æ³•ä¹‹ä¸€ï¼Œä½¿ç”¨åŠ æƒè½®è¯¢æ–¹å¼åˆ†å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰ç…§æŒ‡å®šçš„æƒé‡æ¯”ä¾‹åˆ†å‘ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ip_vs_sh</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IPVS çš„ä¸€ç§è°ƒåº¦ç®—æ³•ä¹‹ä¸€ï¼Œä½¿ç”¨å“ˆå¸Œæ–¹å¼æ ¹æ®æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€æ¥åˆ†å‘è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># nf_conntrack</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œç”¨äºè·Ÿè¸ªå’Œç®¡ç†ç½‘ç»œè¿æ¥ï¼ŒåŒ…æ‹¬ TCPã€UDP å’Œ ICMP ç­‰åè®®ã€‚å®ƒæ˜¯å®ç°é˜²ç«å¢™çŠ¶æ€è·Ÿè¸ªçš„åŸºç¡€ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ip_tables</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæä¾›äº†å¯¹ Linux ç³»ç»Ÿ IP æ•°æ®åŒ…è¿‡æ»¤å’Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰åŠŸèƒ½çš„æ”¯æŒã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ip_set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæ‰©å±•äº† iptables çš„åŠŸèƒ½ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„ IP åœ°å€é›†åˆæ“ä½œã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># xt_set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæ‰©å±•äº† iptables çš„åŠŸèƒ½ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„æ•°æ®åŒ…åŒ¹é…å’Œæ“ä½œã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ipt_set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·ç©ºé—´å·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç† xt_set å†…æ ¸æ¨¡å—ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ipt_rpfilter</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œç”¨äºå®ç°åå‘è·¯å¾„è¿‡æ»¤ï¼Œç”¨äºé˜²æ­¢ IP æ¬ºéª—å’Œ DDoS æ”»å‡»ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ipt_REJECT</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ª iptables ç›®æ ‡ï¼Œç”¨äºæ‹’ç» IP æ•°æ®åŒ…ï¼Œå¹¶å‘å‘é€æ–¹å‘é€å“åº”ï¼ŒæŒ‡ç¤ºæ•°æ®åŒ…è¢«æ‹’ç»ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ipip</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œç”¨äºå®ç° IP å°è£…åœ¨ IPï¼ˆIP-over-IPï¼‰çš„éš§é“åŠŸèƒ½ã€‚å®ƒå¯ä»¥åœ¨ä¸åŒç½‘ç»œä¹‹é—´åˆ›å»ºè™šæ‹Ÿéš§é“æ¥ä¼ è¾“ IP æ•°æ®åŒ…ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å†…æ ¸å‚æ•°">ä¿®æ”¹å†…æ ¸å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">fs.may_detach_mounts = 1</span><br><span class="line">vm.overcommit_memory=1</span><br><span class="line">vm.panic_on_oom=0</span><br><span class="line">fs.inotify.max_user_watches=89100</span><br><span class="line">fs.file-max=52706963</span><br><span class="line">fs.nr_open=52706963</span><br><span class="line">net.netfilter.nf_conntrack_max=2310720</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_keepalive_intvl =15</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_max_orphans = 327680</span><br><span class="line">net.ipv4.tcp_orphan_retries = 3</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line"></span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 0</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 0</span><br><span class="line">net.ipv6.conf.lo.disable_ipv6 = 0</span><br><span class="line">net.ipv6.conf.all.forwarding = 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf</span><br><span class="line">sysctl --system</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™äº›æ˜¯Linuxç³»ç»Ÿçš„ä¸€äº›å‚æ•°è®¾ç½®ï¼Œç”¨äºé…ç½®å’Œä¼˜åŒ–ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿå’Œè™šæ‹Ÿå†…å­˜ç­‰æ–¹é¢çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 1. net.ipv4.ip_forward = 1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - è¿™ä¸ªå‚æ•°å¯ç”¨äº†IPv4çš„IPè½¬å‘åŠŸèƒ½ï¼Œå…è®¸æœåŠ¡å™¨ä½œä¸ºç½‘ç»œè·¯ç”±å™¨è½¬å‘æ•°æ®åŒ…ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 2. net.bridge.bridge-nf-call-iptables = 1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - å½“ä½¿ç”¨ç½‘ç»œæ¡¥æ¥æŠ€æœ¯æ—¶ï¼Œå°†æ•°æ®åŒ…ä¼ é€’åˆ°iptablesè¿›è¡Œå¤„ç†ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> </span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. fs.may_detach_mounts = 1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - å…è®¸åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå…è®¸è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> </span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. vm.overcommit_memory=1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - è¯¥è®¾ç½®å…è®¸åŸå§‹çš„å†…å­˜è¿‡é‡åˆ†é…ç­–ç•¥ï¼Œå½“ç³»ç»Ÿçš„å†…å­˜å·²ç»è¢«å®Œå…¨ä½¿ç”¨æ—¶ï¼Œç³»ç»Ÿä»ç„¶ä¼šåˆ†é…é¢å¤–çš„å†…å­˜ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 5. vm.panic_on_oom=0</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - å½“ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼ˆOOMï¼‰æ—¶ï¼Œç¦ç”¨ç³»ç»Ÿå´©æºƒå’Œé‡å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 6. fs.inotify.max_user_watches=89100</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»Ÿå…è®¸ä¸€ä¸ªç”¨æˆ·çš„inotifyå®ä¾‹å¯ä»¥ç›‘æ§çš„æ–‡ä»¶æ•°ç›®çš„ä¸Šé™ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 7. fs.file-max=52706963</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»ŸåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°çš„ä¸Šé™ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 8. fs.nr_open=52706963</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»ŸåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°çš„ä¸Šé™ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 9. net.netfilter.nf_conntrack_max=2310720</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„ç½‘ç»œè¿æ¥è·Ÿè¸ªè¡¨é¡¹çš„æœ€å¤§æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 10. net.ipv4.tcp_keepalive_time = 600</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®TCPå¥—æ¥å­—çš„ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…è¿‡è¯¥æ—¶é—´æ²¡æœ‰æ´»åŠ¨æ•°æ®æ—¶ï¼Œå†…æ ¸ä¼šå‘é€å¿ƒè·³åŒ…ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 11. net.ipv4.tcp_keepalive_probes = 3</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®æœªæ”¶åˆ°å“åº”çš„TCPå¿ƒè·³æ¢æµ‹æ¬¡æ•°ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 12. net.ipv4.tcp_keepalive_intvl = 15</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®TCPå¿ƒè·³æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 13. net.ipv4.tcp_max_tw_buckets = 36000</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 14. net.ipv4.tcp_tw_reuse = 1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å¯ç”¨TIME_WAITå¥—æ¥å­—çš„é‡æ–°åˆ©ç”¨ï¼Œå…è®¸æ–°çš„å¥—æ¥å­—ä½¿ç”¨æ—§çš„TIME_WAITå¥—æ¥å­—ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 15. net.ipv4.tcp_max_orphans = 327680</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯ä»¥åŒæ—¶å­˜åœ¨çš„TCPå¥—æ¥å­—åƒåœ¾å›æ”¶åŒ…è£¹æ•°çš„æœ€å¤§æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 16. net.ipv4.tcp_orphan_retries = 3</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯¹äºå­¤ç«‹çš„TCPå¥—æ¥å­—çš„é‡è¯•æ¬¡æ•°ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 17. net.ipv4.tcp_syncookies = 1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å¯ç”¨TCP SYN cookiesä¿æŠ¤ï¼Œç”¨äºé˜²æ­¢SYNæ´ªæ³›æ”»å‡»ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 18. net.ipv4.tcp_max_syn_backlog = 16384</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®æ–°çš„TCPè¿æ¥çš„åŠè¿æ¥æ•°ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰çš„æœ€å¤§é•¿åº¦ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 19. net.ipv4.ip_conntrack_max = 65536</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„ç½‘ç»œè¿æ¥è·Ÿè¸ªè¡¨é¡¹çš„æœ€å¤§æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 20. net.ipv4.tcp_timestamps = 0</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å…³é—­TCPæ—¶é—´æˆ³åŠŸèƒ½ï¼Œç”¨äºæä¾›æ›´å¥½çš„å®‰å…¨æ€§ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 21. net.core.somaxconn = 16384</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿæ ¸å¿ƒå±‚çš„è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 22. net.ipv6.conf.all.disable_ipv6 = 0</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å¯ç”¨IPv6åè®®ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 23. net.ipv6.conf.default.disable_ipv6 = 0</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å¯ç”¨IPv6åè®®ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 24. net.ipv6.conf.lo.disable_ipv6 = 0</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å¯ç”¨IPv6åè®®ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 25. net.ipv6.conf.all.forwarding = 1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    - å…è®¸IPv6æ•°æ®åŒ…è½¬å‘ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">modprobe br_netfilter è¯¥å‘½ä»¤åŠ è½½ br_netfilter å†…æ ¸æ¨¡å—ï¼Œè¯¥æ¨¡å—å…è®¸æ¡¥æ¥æ¥å£çš„è¿‡æ»¤åŠŸèƒ½ï¼ˆé€šå¸¸æ˜¯å¤„ç†ç½‘ç»œåŒ…ï¼‰ã€‚å®ƒæ˜¯å¯ç”¨ Kubernetes é›†ç¾¤çš„å®¹å™¨ç½‘ç»œåŠŸèƒ½ï¼ˆå¦‚ç½‘ç»œç­–ç•¥ï¼‰çš„å¿…è¦æ¨¡å—ï¼Œç‰¹åˆ«æ˜¯åœ¨èŠ‚ç‚¹ä¸Šä½¿ç”¨æ¡¥æ¥ç½‘ç»œæ—¶ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sysctl -p /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯¥å‘½ä»¤åº”ç”¨ /etc/sysctl.d/k8s.conf é…ç½®æ–‡ä»¶ä¸­çš„å†…æ ¸å‚æ•°ã€‚é€šå¸¸ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸ Kubernetes å’Œå®¹å™¨ç½‘ç»œç›¸å…³çš„é…ç½®ï¼Œç±»ä¼¼äºå¯ç”¨ IP è½¬å‘ï¼ˆnet.ipv4.ip_forwardï¼‰å’Œå…¶ä»–ç½‘ç»œä¼˜åŒ–è®¾ç½®ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sysctl --system</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯¥å‘½ä»¤é‡æ–°åŠ è½½æ‰€æœ‰çš„ sysctl é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ /etc/sysctl.conf å’Œ /etc/sysctl.d/ ç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚å®ƒåº”ç”¨ç³»ç»Ÿçº§åˆ«çš„å†…æ ¸å‚æ•°è®¾ç½®ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„å†…æ ¸é…ç½®ç¬¦åˆé¢„æœŸã€‚</span></span><br></pre></td></tr></table></figure><h3 id="æ‰€æœ‰èŠ‚ç‚¹é…ç½®-hosts-æœ¬åœ°è§£æ">æ‰€æœ‰èŠ‚ç‚¹é…ç½® hosts æœ¬åœ°è§£æ</h3><p>ä¿®æ”¹ <code>/etc/hosts</code> æ–‡ä»¶ï¼Œæ–°å¢èŠ‚ç‚¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.157.128 master</span><br><span class="line">192.168.157.129 node1</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å®¹å™¨">é…ç½®å®¹å™¨</h2><p><code>containerd</code> æˆ–è€… <code>cri-o</code> äºŒé€‰ä¸€</p><h3 id="é…ç½®containerd">é…ç½®containerd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½æ‰€éœ€åº”ç”¨åŒ…</span></span><br><span class="line">wget https://github.com/containerd/containerd/releases/download/v1.7.18/cri-containerd-cni-1.7.18-linux-amd64.tar.gz</span><br><span class="line">wget https://github.com/containernetworking/plugins/releases/download/v1.5.1/cni-plugins-linux-amd64-v1.5.1.tgz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">centos7 è¦å‡çº§libseccomp</span></span><br><span class="line">yum -y install https://yum.oracle.com/repo/OracleLinux/OL8/baseos/latest/x86_64/getPackage/libseccomp-2.5.1-1.el8.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºcniæ’ä»¶æ‰€éœ€ç›®å½•</span></span><br><span class="line">mkdir -p /etc/cni/net.d /opt/cni/bin </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è§£å‹cniäºŒè¿›åˆ¶åŒ…</span></span><br><span class="line">tar xf cni-plugins-linux-amd64-v*.tgz -C /opt/cni/bin/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è§£å‹</span></span><br><span class="line">tar -xzf cri-containerd-cni-*-linux-amd64.tar.gz -C /</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</span></span><br><span class="line">cat &gt; /etc/systemd/system/containerd.service &lt;&lt;EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=containerd container runtime</span><br><span class="line">Documentation=https://containerd.io</span><br><span class="line">After=network.target local-fs.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStartPre=-/sbin/modprobe overlay</span><br><span class="line">ExecStart=/usr/local/bin/containerd</span><br><span class="line">Type=notify</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">TasksMax=infinity</span><br><span class="line">OOMScoreAdjust=-999</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="é…ç½®å†…æ ¸">é…ç½®å†…æ ¸</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½® Containerd æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span><br><span class="line">overlay</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ è½½æ¨¡å—</span></span><br><span class="line">systemctl restart systemd-modules-load.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½® Containerd æ‰€éœ€çš„å†…æ ¸</span></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span><br><span class="line">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="line">net.ipv4.ip_forward                 = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ è½½å†…æ ¸</span></span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹é»˜è®¤é…ç½®">ä¿®æ”¹é»˜è®¤é…ç½®</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/containerd</span><br><span class="line">containerd config default | tee /etc/containerd/config.toml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ Containerd çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">sed -i &quot;s#SystemdCgroup\ \=\ false#SystemdCgroup\ \=\ true#g&quot; /etc/containerd/config.toml</span><br><span class="line">cat /etc/containerd/config.toml | grep SystemdCgroup</span><br><span class="line">sed -i &quot;s#registry.k8s.io/pause:3.8#k8s.m.daocloud.io/pause:3.10#g&quot; /etc/containerd/config.toml</span><br><span class="line">cat /etc/containerd/config.toml | grep sandbox_image</span><br><span class="line">sed -i &quot;s#config_path\ \=\ \&quot;\&quot;#config_path\ \=\ \&quot;/etc/containerd/certs.d\&quot;#g&quot; /etc/containerd/config.toml</span><br><span class="line">cat /etc/containerd/config.toml | grep certs.d</span><br></pre></td></tr></table></figure><h4 id="é…ç½®åŠ é€Ÿå™¨">é…ç½®åŠ é€Ÿå™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®åŠ é€Ÿå™¨</span></span><br><span class="line">mkdir /etc/containerd/certs.d/docker.io -pv</span><br><span class="line">cat &gt; /etc/containerd/certs.d/docker.io/hosts.toml &lt;&lt; EOF</span><br><span class="line">server = &quot;https://docker.io&quot;</span><br><span class="line">[host.&quot;https://docker.m.daocloud.io&quot;]</span><br><span class="line">  capabilities = [&quot;pull&quot;, &quot;resolve&quot;]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mkdir /etc/containerd/certs.d/registry.k8s.io -pv</span><br><span class="line">cat &gt; /etc/containerd/certs.d/registry.k8s.io/hosts.toml &lt;&lt; EOF</span><br><span class="line">server = &quot;https://registry.k8s.io&quot;</span><br><span class="line">[host.&quot;https://k8s.m.daocloud.io&quot;]</span><br><span class="line">  capabilities = [&quot;pull&quot;, &quot;resolve&quot;]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨">å¯åŠ¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable --now containerd.service</span><br><span class="line">systemctl stop containerd.service</span><br><span class="line">systemctl start containerd.service</span><br><span class="line">systemctl restart containerd.service</span><br><span class="line">systemctl status containerd.service</span><br></pre></td></tr></table></figure><h3 id="é…ç½®CRI-O">é…ç½®CRI-O</h3><h4 id="é…ç½®å†…æ ¸-2">é…ç½®å†…æ ¸</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½® CRI-O æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line">cat &gt; /etc/modules-load.d/crio.conf &lt;&lt; EOF</span><br><span class="line">overlay</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ è½½æ¨¡å—</span></span><br><span class="line">modprobe overlay</span><br><span class="line">systemctl restart systemd-modules-load.service</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…">å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">VERSION=1.28</span><br><span class="line">OS=CentOS_7</span><br><span class="line"></span><br><span class="line">curl -L -o /etc/yum.repos.d/devel:kubic:libcontainers:stable.repo https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/$OS/devel:kubic:libcontainers:stable.repo</span><br><span class="line"></span><br><span class="line">curl -L -o /etc/yum.repos.d/devel:kubic:libcontainers:stable:cri-o:$VERSION.repo https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable:cri-o:$VERSION/$OS/devel:kubic:libcontainers:stable:cri-o:$VERSION.repo</span><br><span class="line"></span><br><span class="line">yum install -y cri-o</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/crio/crio.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ pause_image</span> </span><br><span class="line">pause_image = &quot;k8s.m.daocloud.io/pause:3.10&quot;</span><br><span class="line"></span><br><span class="line">vi /etc/containers/registries.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ unqualified-search-registries</span></span><br><span class="line">unqualified-search-registries = [&quot;docker.m.daocloud.io&quot;, &quot;k8s.m.daocloud.io&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable --now crio.service</span><br><span class="line">systemctl stop crio.service</span><br><span class="line">systemctl start crio.service</span><br><span class="line">systemctl restart crio.service</span><br><span class="line">systemctl status crio.service</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å®‰è£…æº">é…ç½®å®‰è£…æº</h2><p>Kubernetes æ˜¯ä¸€ä¸ªå¼€æºç³»ç»Ÿï¼Œç”¨äºå®¹å™¨åŒ–åº”ç”¨çš„è‡ªåŠ¨éƒ¨ç½²ã€æ‰©ç¼©å’Œç®¡ç†ã€‚å®ƒå°†æ„æˆåº”ç”¨çš„å®¹å™¨æŒ‰é€»è¾‘å•ä½è¿›è¡Œåˆ†ç»„ä»¥ä¾¿äºç®¡ç†å’Œå‘ç°ã€‚</p><p>ç”±äº Kubernetes å®˜æ–¹å˜æ›´äº†ä»“åº“çš„å­˜å‚¨è·¯å¾„ä»¥åŠä½¿ç”¨æ–¹å¼ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ 1.28 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨ æ–°ç‰ˆé…ç½®æ–¹æ³• è¿›è¡Œé…ç½®ã€‚</p><p>centos</p><p>æ³¨æ„ä¿®æ”¹ä¸ºè‡ªå·±éœ€è¦çš„ç‰ˆæœ¬å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.31/rpm/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.31/rpm/repodata/repomd.xml.key</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum update -y &amp;&amp; yum install -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é•œåƒ">ä¿®æ”¹é•œåƒ</h3><p>coredns é•œåƒååœ¨æ‹‰å–çš„æ—¶å€™æœ‰åç§°é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹åç§°</p><p>å¦‚æœä½¿ç”¨ CRI-Oï¼Œè¯·ä½¿ç”¨ podman æ›´æ”¹é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬æœ‰é‚£äº›é•œåƒ</span></span><br><span class="line">kubeadm config images list --image-repository k8s.m.daocloud.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‹‰å–é•œåƒ</span></span><br><span class="line">ctr --namespace k8s.io images pull k8s.m.daocloud.io/coredns/coredns:v1.11.3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹é•œåƒåç§°</span></span><br><span class="line">ctr --namespace k8s.io images tag k8s.m.daocloud.io/coredns/coredns:v1.11.3 k8s.m.daocloud.io/coredns:v1.11.3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é•œåƒ</span></span><br><span class="line">ctr --namespace k8s.io images ls | grep coredns</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹åˆå§‹åŒ–é…ç½®">ä¿®æ”¹åˆå§‹åŒ–é…ç½®</h3><p>master èŠ‚ç‚¹æ“ä½œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿæˆé»˜è®¤é…ç½®</span></span><br><span class="line">kubeadm config print init-defaults &gt; kubeadm.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 192.168.157.128 # ä¿®æ”¹ä¸º master IP</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: unix:///var/run/containerd/containerd.sock # å¦‚æœä¸º containerd åˆ™ä¸éœ€è¦ä¿®æ”¹ï¼Œå¦‚æœæ˜¯ CRI-Oï¼Œåˆ™ä¿®æ”¹ä¸ºunix:///var/run/crio/crio.sock</span><br><span class="line">  name: master # ä¿®æ”¹ä¸º master çš„ä¸»æœºå</span><br><span class="line">  </span><br><span class="line">imageRepository: k8s.m.daocloud.io # ä¿®æ”¹é•œåƒåŠ é€Ÿ</span><br><span class="line">kubernetesVersion: 1.31.2 # ä¿®æ”¹é•œåƒç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">podSubnet: 172.16.0.0/12 # åœ¨ dnsDomain: cluster.local ä¸‹æ·»åŠ </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æœ€æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">---</span><br><span class="line">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="line">kind: KubeProxyConfiguration</span><br><span class="line">mode: ipvs</span><br><span class="line">---</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">cgroupDriver: systemd</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h2><p>master èŠ‚ç‚¹ä¸Šæ“ä½œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆå§‹åŒ– k8s</span></span><br><span class="line">kubeadm init --config=kubeadm.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®config</span></span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡æ–°åˆå§‹åŒ–</span></span><br><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><p>node èŠ‚ç‚¹è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨nodeä¸Šæ‰§è¡Œæ“ä½œï¼Œå°†åŠ å…¥å·¥ä½œèŠ‚ç‚¹</span></span><br><span class="line">cat &gt; kubeadm-join-node.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">kind: JoinConfiguration</span><br><span class="line">discovery:</span><br><span class="line">  bootstrapToken:</span><br><span class="line">    apiServerEndpoint: 192.168.157.128:6443 # è¿™é‡Œä¿®æ”¹ä¸ºmasterçš„ipåŠ å¯¹åº”çš„ç»‘å®šç«¯å£</span><br><span class="line">    token: &quot;abcdef.0123456789abcdef&quot; # è¿™é‡Œä¿®æ”¹ä¸ºmasterçš„k8såˆå§‹åŒ–é…ç½®æ–‡ä»¶ä¸­çš„token</span><br><span class="line">    caCertHashes:</span><br><span class="line">    - &quot;sha256:e614d994febfbebd58d8c78df839532ddabb05b5f3466fdf0018546fc010c9a0&quot;</span><br><span class="line">    # è¯·æ›´æ”¹ä¸Šé¢çš„è®¤è¯ä¿¡æ¯ï¼Œä½¿ä¹‹ä¸ä½ çš„é›†ç¾¤ä¸­å®é™…ä½¿ç”¨çš„ä»¤ç‰Œå’Œ CA è¯ä¹¦åŒ¹é…</span><br><span class="line">nodeRegistration:</span><br><span class="line">  kubeletExtraArgs:</span><br><span class="line">    node-ip: 192.168.157.129 # è¿™é‡Œä¿®æ”¹ä¸ºnodeçš„IP</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">kubeadm join --config=kubeadm-join-node.yaml</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-Calico">é…ç½® Calico</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/projectcalico/calico/refs/heads/master/manifests/calico-typha.yaml</span><br><span class="line"></span><br><span class="line">vi calico-typha.yaml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ CALICO_IPV4POOL_CIDR é…ç½®</span></span><br><span class="line">    - name: CALICO_IPV4POOL_CIDR</span><br><span class="line">      value: &quot;172.16.0.0/12&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢å›½å†…ä»“åº“</span></span><br><span class="line">sed -i &quot;s#docker.io/calico/#docker.m.daocloud.io/calico/#g&quot; calico-typha.yaml </span><br><span class="line"></span><br><span class="line">kubectl apply -f calico-typha.yaml</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-Metrics-Server">é…ç½® Metrics-Server</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br><span class="line"></span><br><span class="line">vim components.yaml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ - --kubelet-insecure-tls</span></span><br><span class="line">  - args:</span><br><span class="line">        - --cert-dir=/tmp</span><br><span class="line">        - --secure-port=10250</span><br><span class="line">        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><br><span class="line">        - --kubelet-use-node-status-port</span><br><span class="line">        - --metric-resolution=15s</span><br><span class="line">        - --kubelet-insecure-tls</span><br><span class="line">      </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹é•œåƒåœ°å€</span></span><br><span class="line">sed -i &quot;s#registry.k8s.io#k8s.m.daocloud.io#g&quot; components.yaml</span><br><span class="line">cat components.yaml | grep image</span><br><span class="line"></span><br><span class="line">kubectl apply -f components.yaml</span><br><span class="line"></span><br><span class="line">kubectl  top node</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½">é…ç½®å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install bash-completion -y</span><br><span class="line">source /usr/share/bash-completion/bash_completion</span><br><span class="line">source &lt;(kubectl completion bash)</span><br><span class="line">echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure><h1>HELM</h1><h2 id="ä»‹ç»-2">ä»‹ç»</h2><p>Helm å®‰è£… <em>charts</em> åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <em>release</em>ã€‚ä½ å¯ä»¥åœ¨ Helm çš„ chart <em>repositories</em> ä¸­å¯»æ‰¾æ–°çš„ chartã€‚<a href="%5BHelm%5D(https://helm.sh/)">^12</a></p><p><em>Chart</em> ä»£è¡¨ç€ Helm åŒ…ã€‚å®ƒåŒ…å«åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ Homebrew formulaï¼ŒApt dpkgï¼Œæˆ– Yum RPM åœ¨Kubernetes ä¸­çš„ç­‰ä»·ç‰©ã€‚</p><p><em>Repositoryï¼ˆä»“åº“ï¼‰</em> æ˜¯ç”¨æ¥å­˜æ”¾å’Œå…±äº« charts çš„åœ°æ–¹ã€‚å®ƒå°±åƒ Perl çš„ <a href="https://www.cpan.org/">CPAN æ¡£æ¡ˆåº“ç½‘ç»œ</a> æˆ–æ˜¯ Fedora çš„ <a href="https://src.fedoraproject.org/">è½¯ä»¶åŒ…ä»“åº“</a>ï¼Œåªä¸è¿‡å®ƒæ˜¯ä¾› Kubernetes åŒ…æ‰€ä½¿ç”¨çš„ã€‚</p><p><em>Release</em> æ˜¯è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ chart çš„å®ä¾‹ã€‚ä¸€ä¸ª chart é€šå¸¸å¯ä»¥åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­å®‰è£…å¤šæ¬¡ã€‚æ¯ä¸€æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <em>release</em>ã€‚ä»¥ MySQL chartä¸ºä¾‹ï¼Œå¦‚æœä½ æƒ³åœ¨ä½ çš„é›†ç¾¤ä¸­è¿è¡Œä¸¤ä¸ªæ•°æ®åº“ï¼Œä½ å¯ä»¥å®‰è£…è¯¥chartä¸¤æ¬¡ã€‚æ¯ä¸€ä¸ªæ•°æ®åº“éƒ½ä¼šæ‹¥æœ‰å®ƒè‡ªå·±çš„ <em>release</em> å’Œ <em>release name</em>ã€‚</p><h2 id="å®‰è£…HELM">å®‰è£…HELM</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.huaweicloud.com/helm/v3.16.3/helm-v3.16.3-linux-amd64.tar.gz</span><br><span class="line">tar xvf helm-*-linux-amd64.tar.gz</span><br><span class="line">cp linux-amd64/helm /usr/local/bin/</span><br></pre></td></tr></table></figure><h2 id="æ“ä½œHELM">æ“ä½œHELM</h2><h3 id="æŸ¥æ‰¾-charts">æŸ¥æ‰¾ charts</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm search hub [app_name] # ä» Artifact Hub ä¸­æŸ¥æ‰¾å¹¶åˆ—å‡º helm chartsã€‚ Artifact Hubä¸­å­˜æ”¾äº†å¤§é‡ä¸åŒçš„ä»“åº“ã€‚</span><br><span class="line">helm search repo [repo_name|app_name] # ä»ä½ æ·»åŠ ï¼ˆä½¿ç”¨ helm repo addï¼‰åˆ°æœ¬åœ° helm å®¢æˆ·ç«¯ä¸­çš„ä»“åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚è¯¥å‘½ä»¤åŸºäºæœ¬åœ°æ•°æ®è¿›è¡Œæœç´¢ï¼Œæ— éœ€è¿æ¥äº’è”ç½‘ã€‚</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å‰è‡ªå®šä¹‰-chart">å®‰è£…å‰è‡ªå®šä¹‰ chart</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm show values [app_name] # å¯ä»¥æŸ¥çœ‹ chart ä¸­çš„å¯é…ç½®é€‰é¡¹</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä½¿ç”¨ YAML æ ¼å¼çš„æ–‡ä»¶è¦†ç›–ä¸Šè¿°ä»»æ„é…ç½®é¡¹ï¼Œå¹¶åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨è¯¥æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;&#123;mariadb.auth.database: user0db, mariadb.auth.username: user0&#125;&#x27; &gt; values.yaml</span><br><span class="line">helm install -f values.yaml bitnami/wordpress --generate-name</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å°†ä¸º MariaDB åˆ›å»ºä¸€ä¸ªåç§°ä¸º <code>user0</code> çš„é»˜è®¤ç”¨æˆ·ï¼Œå¹¶ä¸”æˆäºˆè¯¥ç”¨æˆ·è®¿é—®æ–°å»ºçš„ <code>user0db</code> æ•°æ®åº“çš„æƒé™ã€‚chart ä¸­çš„å…¶ä»–é»˜è®¤é…ç½®ä¿æŒä¸å˜ã€‚<code>--generate-name</code>éšæœºç”Ÿæˆreleaseåå­—</p><p>å®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸¤ç§æ–¹å¼ä¼ é€’é…ç½®æ•°æ®ï¼š</p><ul><li><code>--values</code> (æˆ– <code>-f</code>)ï¼šä½¿ç”¨ YAML æ–‡ä»¶è¦†ç›–é…ç½®ã€‚å¯ä»¥æŒ‡å®šå¤šæ¬¡ï¼Œä¼˜å…ˆä½¿ç”¨æœ€å³è¾¹çš„æ–‡ä»¶ã€‚</li><li><code>--set</code>ï¼šé€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å¯¹æŒ‡å®šé¡¹è¿›è¡Œè¦†ç›–ã€‚</li></ul><p>å¦‚æœåŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼Œåˆ™ <code>--set</code> ä¸­çš„å€¼ä¼šè¢«åˆå¹¶åˆ° <code>--values</code> ä¸­ï¼Œä½†æ˜¯ <code>--set</code> ä¸­çš„å€¼ä¼˜å…ˆçº§æ›´é«˜ã€‚åœ¨<code>--set</code> ä¸­è¦†ç›–çš„å†…å®¹ä¼šè¢«è¢«ä¿å­˜åœ¨ ConfigMap ä¸­ã€‚å¯ä»¥é€šè¿‡ <code>helm get values &lt;release-name&gt;</code> æ¥æŸ¥çœ‹æŒ‡å®š release ä¸­ <code>--set</code> è®¾ç½®çš„å€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è¿è¡Œ <code>helm upgrade</code> å¹¶æŒ‡å®š <code>--reset-values</code> å­—æ®µæ¥æ¸…é™¤ <code>--set</code> ä¸­è®¾ç½®çš„å€¼ã€‚</p><h3 id="è¿½è¸ª-release-çš„çŠ¶æ€">è¿½è¸ª release çš„çŠ¶æ€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm status &lt;release&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h3 id="æ›´å¤šå®‰è£…æ–¹æ³•">æ›´å¤šå®‰è£…æ–¹æ³•</h3><p><code>helm install</code> å‘½ä»¤å¯ä»¥ä»å¤šä¸ªæ¥æºè¿›è¡Œå®‰è£…ï¼š</p><ul><li>chart çš„ä»“åº“ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰</li><li>æœ¬åœ° chart å‹ç¼©åŒ…ï¼ˆ<code>helm install foo foo-0.1.1.tgz</code>ï¼‰</li><li>è§£å‹åçš„ chart ç›®å½•ï¼ˆ<code>helm install foo path/to/foo</code>ï¼‰</li><li>å®Œæ•´çš„ URLï¼ˆ<code>helm install foo https://example.com/charts/foo-1.2.3.tgz</code>ï¼‰</li></ul><h3 id="å‡çº§-release">å‡çº§ release</h3><p>å½“ä½ æƒ³å‡çº§åˆ° chart çš„æ–°ç‰ˆæœ¬ï¼Œæˆ–æ˜¯ä¿®æ”¹ release çš„é…ç½®ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>helm upgrade</code> å‘½ä»¤ã€‚</p><p>ä¸€æ¬¡å‡çº§æ“ä½œä¼šä½¿ç”¨å·²æœ‰çš„ release å¹¶æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯å¯¹å…¶è¿›è¡Œå‡çº§ã€‚ç”±äº Kubernetes çš„ chart å¯èƒ½ä¼šå¾ˆå¤§è€Œä¸”å¾ˆå¤æ‚ï¼ŒHelm ä¼šå°è¯•æ‰§è¡Œæœ€å°ä¾µå…¥å¼å‡çº§ã€‚å³å®ƒåªä¼šæ›´æ–°è‡ªä¸Šæ¬¡å‘å¸ƒä»¥æ¥å‘ç”Ÿäº†æ›´æ”¹çš„å†…å®¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm upgrade -f panda.yaml happy-panda bitnami/wordpress</span><br></pre></td></tr></table></figure><p><code>happy-panda</code> è¿™ä¸ª release ä½¿ç”¨ç›¸åŒçš„ chart è¿›è¡Œå‡çº§ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„ YAML æ–‡ä»¶</p><p>å¯ä»¥ä½¿ç”¨ <code>helm get values</code> å‘½ä»¤æ¥çœ‹çœ‹é…ç½®å€¼æ˜¯å¦çœŸçš„ç”Ÿæ•ˆäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm get values happy-panda</span><br></pre></td></tr></table></figure><h3 id="å¤±è´¥æ—¶æ¢å¤">å¤±è´¥æ—¶æ¢å¤</h3><p>åœ¨ä¸€æ¬¡å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿäº†ä¸ç¬¦åˆé¢„æœŸçš„äº‹æƒ…ï¼Œä¹Ÿå¾ˆå®¹æ˜“é€šè¿‡ <code>helm rollback [RELEASE] [REVISION]</code> å‘½ä»¤å›æ»šåˆ°ä¹‹å‰çš„å‘å¸ƒç‰ˆæœ¬ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm rollback happy-panda 1</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ¡å‘½ä»¤å°†æˆ‘ä»¬çš„ <code>happy-panda</code> å›æ»šåˆ°äº†å®ƒæœ€åˆçš„ç‰ˆæœ¬ã€‚release ç‰ˆæœ¬å…¶å®æ˜¯ä¸€ä¸ªå¢é‡ä¿®è®¢ï¼ˆrevisionï¼‰ã€‚ æ¯å½“å‘ç”Ÿäº†ä¸€æ¬¡å®‰è£…ã€å‡çº§æˆ–å›æ»šæ“ä½œï¼Œrevision çš„å€¼å°±ä¼šåŠ 1ã€‚ç¬¬ä¸€æ¬¡ revision çš„å€¼æ°¸è¿œæ˜¯1ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>helm history [RELEASE]</code> å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ªç‰¹å®š release çš„ä¿®è®¢ç‰ˆæœ¬å·ã€‚</p><h3 id="å¸è½½-release">å¸è½½ release</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall happy-panda</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡ <code>helm list</code> å‘½ä»¤çœ‹åˆ°å½“å‰éƒ¨ç½²çš„æ‰€æœ‰ release</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm list -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ Helm 3 ä¸­ï¼Œåˆ é™¤ä¼šç§»é™¤ release çš„è®°å½•ã€‚ å¦‚æœä½ æƒ³ä¿ç•™åˆ é™¤è®°å½•ï¼Œä½¿ç”¨ <code>helm uninstall --keep-history</code>ã€‚ä½¿ç”¨ <code>helm list --uninstalled</code> åªä¼šå±•ç¤ºä½¿ç”¨äº† <code>--keep-history</code> åˆ é™¤çš„ releaseã€‚</p><p><code>helm list --all</code> ä¼šå±•ç¤º Helm ä¿ç•™çš„æ‰€æœ‰ release è®°å½•ï¼ŒåŒ…æ‹¬å¤±è´¥æˆ–åˆ é™¤çš„æ¡ç›®ï¼ˆæŒ‡å®šäº† <code>--keep-history</code>ï¼‰</p><h3 id="ä½¿ç”¨ä»“åº“">ä½¿ç”¨ä»“åº“</h3><p>Helm 3 ä¸å†é™„å¸¦ä¸€ä¸ªé»˜è®¤çš„ chart ä»“åº“ã€‚<code>helm repo</code> æä¾›äº†ä¸€ç»„å‘½ä»¤ç”¨äºæ·»åŠ ã€åˆ—å‡ºå’Œç§»é™¤ä»“åº“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helm repo list # æŸ¥çœ‹é…ç½®çš„ä»“åº“</span><br><span class="line">helm repo add dev https://example.com/dev-charts # æ·»åŠ æ–°çš„ä»“åº“</span><br><span class="line">helm repo update # ç¡®ä¿ä½ çš„ Helm å®¢æˆ·ç«¯æ˜¯æœ€æ–°çš„</span><br><span class="line">helm repo remove # ç§»é™¤ä»“åº“</span><br></pre></td></tr></table></figure><p><a href="https://kubernetes.io/docs/home/">Kubernetes Documentation | Kubernetes</a></p><p><a href="https://github.com/cby-chen/Kubernetes?tab=readme-ov-file">cby-chen/Kubernetes: kubernetes (k8s) äºŒè¿›åˆ¶é«˜å¯ç”¨å®‰è£…</a></p><p><a href="https://oraclelinux.pkgs.org/8/ol8-baseos-latest-x86_64/libseccomp-2.5.1-1.el8.x86_64.rpm.html">libseccomp-2.5.1-1.el8.x86_64.rpm Oracle Linux 8 Download</a></p><p><a href="https://github.com/DaoCloud/public-image-mirror">DaoCloud/public-image-mirror</a></p><p><a href="https://mirrors.aliyun.com/kubernetes-new/">kubernetes-newå®‰è£…åŒ…ä¸‹è½½_å¼€æºé•œåƒç«™-é˜¿é‡Œäº‘</a></p><p><a href="https://github.com/containerd/containerd">containerd/containerd: An open and reliable container runtime</a></p><p><a href="https://github.com/containernetworking/plugins">containernetworking/plugins: Some reference and example networking plugins, maintained by the CNI team.</a></p><p><a href="https://mirrors.aliyun.com/kubernetes-new/core/stable/">kubernetes-new-core-stableå®‰è£…åŒ…ä¸‹è½½_å¼€æºé•œåƒç«™-é˜¿é‡Œäº‘</a></p><p><a href="https://github.com/projectcalico/calico/blob/master/manifests/calico-typha.yaml">calico/manifests/calico-typha.yaml at master Â· projectcalico/calico</a></p><p><a href="https://mirrors.huaweicloud.com/helm/">Index of helm-local</a></p><p><a href="https://kubernetes.github.io/dashboard/">Installation | dashboard</a></p>]]></content>
    
    
    <summary type="html">k8s å®‰è£…</summary>
    
    
    
    
  </entry>
  
</feed>
